<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.25">
    <link rel="icon" href="/logo.png"><title>SNI 回落 | Project X</title><meta name="description" content="Xray 官方文档">
    <link rel="preload" href="/assets/js/runtime~app.89709ca3.js" as="script"><link rel="preload" href="/assets/css/styles.436ad7d5.css" as="style"><link rel="preload" href="/assets/js/3469.bd615835.js" as="script"><link rel="preload" href="/assets/js/app.776345c9.js" as="script">
    <link rel="stylesheet" href="/assets/css/styles.436ad7d5.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name">Project X</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="/" class="nav-link" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/about/news.md" class="nav-link" aria-label="大史记"><!--[--><!--]--> 大史记 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/config/" class="nav-link" aria-label="配置指南"><!--[--><!--]--> 配置指南 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/development/" class="nav-link" aria-label="开发指南"><!--[--><!--]--> 开发指南 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/document/" class="nav-link router-link-active" aria-label="使用指南"><!--[--><!--]--> 使用指南 <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="多语言"><span class="title">多语言</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="多语言"><span class="title">多语言</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a aria-current="page" href="/document/level-1/fallbacks-with-sni.html" class="router-link-active router-link-exact-active nav-link router-link-active" aria-label="简体中文"><!--[--><!--]--> 简体中文 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/en/document/level-1/fallbacks-with-sni.html" class="nav-link" aria-label="English (WIP)"><!--[--><!--]--> English (WIP) <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/xtls/xray-core" rel="noopener noreferrer" target="_blank" aria-label="查看源码"><!--[--><!--]--> 查看源码 <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="搜索" autocomplete="off" spellcheck="false" value><!----></form></div></header><div class="sidebar-mask"></div><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/" class="nav-link" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/about/news.md" class="nav-link" aria-label="大史记"><!--[--><!--]--> 大史记 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/config/" class="nav-link" aria-label="配置指南"><!--[--><!--]--> 配置指南 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/development/" class="nav-link" aria-label="开发指南"><!--[--><!--]--> 开发指南 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/document/" class="nav-link router-link-active" aria-label="使用指南"><!--[--><!--]--> 使用指南 <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="多语言"><span class="title">多语言</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="多语言"><span class="title">多语言</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a aria-current="page" href="/document/level-1/fallbacks-with-sni.html" class="router-link-active router-link-exact-active nav-link router-link-active" aria-label="简体中文"><!--[--><!--]--> 简体中文 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/en/document/level-1/fallbacks-with-sni.html" class="nav-link" aria-label="English (WIP)"><!--[--><!--]--> English (WIP) <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/xtls/xray-core" rel="noopener noreferrer" target="_blank" aria-label="查看源码"><!--[--><!--]--> 查看源码 <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><p class="sidebar-heading sidebar-item active">入门技巧</p><ul class=""><li><!--[--><a href="/document/level-1/fallbacks-lv1.html" class="nav-link sidebar-item" aria-label="回落 (fallbacks) 功能简析"><!--[--><!--]--> 回落 (fallbacks) 功能简析 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/document/level-1/routing-lv1-part1.html" class="nav-link sidebar-item" aria-label="路由 (routing) 功能简析（上）"><!--[--><!--]--> 路由 (routing) 功能简析（上） <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/document/level-1/routing-lv1-part2.html" class="nav-link sidebar-item" aria-label="路由 (routing) 功能简析（下）"><!--[--><!--]--> 路由 (routing) 功能简析（下） <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/document/level-1/work.html" class="nav-link sidebar-item" aria-label="Xray 的工作模式"><!--[--><!--]--> Xray 的工作模式 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/document/level-1/fallbacks-with-sni.html" class="router-link-active router-link-exact-active nav-link router-link-active sidebar-item active" aria-label="SNI 回落"><!--[--><!--]--> SNI 回落 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/document/level-1/fallbacks-with-sni.html#应用情景" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="应用情景"><!--[--><!--]--> 应用情景 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/document/level-1/fallbacks-with-sni.html#sni-简介" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="SNI 简介"><!--[--><!--]--> SNI 简介 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/document/level-1/fallbacks-with-sni.html#思路" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="思路"><!--[--><!--]--> 思路 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/document/level-1/fallbacks-with-sni.html#添加-dns-记录" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="添加 DNS 记录"><!--[--><!--]--> 添加 DNS 记录 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/document/level-1/fallbacks-with-sni.html#申请-tls-证书" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="申请 TLS 证书"><!--[--><!--]--> 申请 TLS 证书 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/document/level-1/fallbacks-with-sni.html#xray-配置" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Xray 配置"><!--[--><!--]--> Xray 配置 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/document/level-1/fallbacks-with-sni.html#nginx-配置" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Nginx 配置"><!--[--><!--]--> Nginx 配置 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/document/level-1/fallbacks-with-sni.html#caddy-配置" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Caddy 配置"><!--[--><!--]--> Caddy 配置 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/document/level-1/fallbacks-with-sni.html#参考" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="参考"><!--[--><!--]--> 参考 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/document/level-1/fallbacks-with-sni.html#引用" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="引用"><!--[--><!--]--> 引用 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="通过-sni-回落功能实现伪装与按域名分流" tabindex="-1"><a class="header-anchor" href="#通过-sni-回落功能实现伪装与按域名分流" aria-hidden="true">#</a> 通过 SNI 回落功能实现伪装与按域名分流</h1><p>VLESS 是一种很轻的协议，和 Trojan 一样，不对流量进行复杂的加密和混淆，而是大隐隐于市，通过 TLS 协议加密，混杂在其他 HTTPS 流量中，在墙内外穿进穿出。为了更好的伪装以应对主动探测，Fallbacks 回落功能随 VLESS 同时出现。这篇教程将演示如何使用 Xray 中 VLESS 入站协议的回落功能配合 Nginx 或 Caddy 在保证伪装完全的前提下实现按域名分流。</p><h2 id="应用情景" tabindex="-1"><a class="header-anchor" href="#应用情景" aria-hidden="true">#</a> 应用情景</h2><p>由于 XTLS，Xray 需要监听 443 端口，这导致如果之前有网站运行在服务器上，那么此时网站无法运行或需要运行在其他端口上，这显然是不合理的。有以下三种方案可以解决这个问题：</p><ul><li><p>Xray 监听其他常用端口（如 22、3389、8443）</p><p>这个方案是最简单的，但不够完美。</p></li><li><p>Nginx 或 HAProxy 监听 443 端口，通过 SNI 分流做 L4 反向代理，实现端口复用</p><p>这个方案比较复杂，需要对 Nginx 或 HAProxy 的使用有一定了解，此处不作过多解释。</p></li><li><p>Xray 监听 443 端口，通过 Fallbacks 功能 SNI 分流将网站流量回落到 Nginx 或 Caddy</p><p>这个方案难度适中，也是此教程接下来想要演示的方案。</p></li></ul><h2 id="sni-简介" tabindex="-1"><a class="header-anchor" href="#sni-简介" aria-hidden="true">#</a> SNI 简介</h2><p>服务器名称指示（英语：<strong>S</strong>erver <strong>N</strong>ame <strong>I</strong>ndication，缩写：<strong>SNI</strong>）是 TLS 的一个扩展协议。熟悉反向代理的朋友都知道，如果想要通过域名将流量代理到正确的内容上，需要以下配置：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">proxy_set_header</span> Host 主机名</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>这句的作用是将名为 “Host” 的 HTTP Header 设定为某个主机名。为什么要这样做？一般而言，一台服务器对应一个 IP，但却运行多个网站，访问者通过域名查询到 IP 以访问服务器，那么问题来了，如何确定访问者想要访问的是哪一个网站？这需要“基于名称的虚拟主机”。</p><p>当 Web 服务器收到访问请求后，它会查看请求的主机头，使访问者访问正确的网站。然而当 HTTP 协议被 TLS 协议加密后，这种简单的方法就无法实现了。因为 TLS 握手发生在服务器看到任何 HTTP 头之前，因此，服务器不可能使用 HTTP 主机头中的信息来决定呈现哪个证书，更无法决定访问者的访问目标。</p><p>SNI 的原理也很简单，它通过让客户端发送主机名作为 TLS 协商的一部分来解决此问题。所以在使用 Nginx 对 HTTPS 协议进行反向代理时，需要在配置中加入 <code>proxy_ssl_server_name on;</code>，此时 Nginx 会向被代理的服务器发送 SNI 信息，解决了 HTTPS 协议下虚拟主机失效的问题。另外，使用 SNI 时，即使不指定主机头，也可以正确访问网站。</p><h2 id="思路" tabindex="-1"><a class="header-anchor" href="#思路" aria-hidden="true">#</a> 思路</h2><p><img src="/assets/img/xray-fallbacks.f1e5890a.svg" alt="Xray 回落流程"></p><p>从 443 端口接收到流量后，Xray 会把 TLS 解密后首包长度 &lt; 18、协议版本无效或身份认证失败的流量通过对 name、path、alpn 的匹配转发到 dest 指定的地址。</p><h2 id="添加-dns-记录" tabindex="-1"><a class="header-anchor" href="#添加-dns-记录" aria-hidden="true">#</a> 添加 DNS 记录</h2><p><img src="/assets/img/xray-dns-records.2ea37bda.webp" alt="DNS 记录"></p><p>请按实际情况修改域名和 IP。</p><h2 id="申请-tls-证书" tabindex="-1"><a class="header-anchor" href="#申请-tls-证书" aria-hidden="true">#</a> 申请 TLS 证书</h2><p>由于要对不同前缀的域名进行分流，但一个通配符证书的作用域仅限于两“.”之间（例如：申请 <code>*.example.com</code>，<code>example.com</code> 和 <code>*.*.example.com</code> 并不能使用该证书），故需申请 <a href="https://zh.wikipedia.org/wiki/%E4%B8%BB%E9%A2%98%E5%A4%87%E7%94%A8%E5%90%8D%E7%A7%B0" target="_blank" rel="noopener noreferrer">SAN<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> 通配符证书。根据 Let&#39;s Encrypt 官网信息<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>，申请通配符证书要求 DNS-01 验证方式，此处演示 NS 记录为 Cloudflare 的域名通过 <a href="https://acme.sh" target="_blank" rel="noopener noreferrer">acme.sh<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> 申请 Let&#39;s Encrypt 的免费 TLS 证书。使用其他域名托管商的申请方法请阅读 <a href="https://github.com/acmesh-official/acme.sh/wiki/dnsapi" target="_blank" rel="noopener noreferrer">dnsapi · acmesh-official/acme.sh Wiki<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>。</p><p>首先需要到 <a href="https://dash.cloudflare.com/profile/api-tokens" target="_blank" rel="noopener noreferrer">Cloudflare 面板<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>创建 API Token。参数如下：</p><p><img src="data:image/webp;base64,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" alt="API Token 的权限设置"></p><p>权限部分至关重要，其他部分任意。</p><p>创建完毕后，你会得到一串神秘字符，请将其妥善保管到安全且不会丢失的地方，因为它不再会显示。这串字符就是即将用到的 <code>CF_Token</code>。</p><div class="custom-container tip"><p class="custom-container-title">注意</p><p>以下操作需要在 root 用户下进行，使用 sudo 会出现错误。</p></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">curl</span> https://get.acme.sh <span class="token operator">|</span> <span class="token function">sh</span> <span class="token comment"># 安装 acme.sh</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CF_Token</span><span class="token operator">=</span><span class="token string">&quot;sdfsdfsdfljlbjkljlkjsdfoiwje&quot;</span> <span class="token comment"># 设定 API Token 变量</span>
acme.sh --issue -d example.com -d *.example.com --dns dns_cf <span class="token comment"># 使用 DNS-01 验证方式申请证书</span>
<span class="token function">mkdir</span> /etc/ssl/xray <span class="token comment"># 新建证书存放目录</span>
acme.sh --install-cert -d example.com --fullchain-file /etc/ssl/xray/cert.pem --key-file /etc/ssl/xray/privkey.key --reloadcmd <span class="token string">&quot;chown nobody:nogroup -R /etc/ssl/xray &amp;&amp; systemctl restart xray&quot;</span> <span class="token comment"># 安装证书到指定目录并设定自动续签生效指令</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="xray-配置" tabindex="-1"><a class="header-anchor" href="#xray-配置" aria-hidden="true">#</a> Xray 配置</h2><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;log&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;loglevel&quot;</span><span class="token operator">:</span> <span class="token string">&quot;warning&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;inbounds&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">443</span><span class="token punctuation">,</span>
      <span class="token property">&quot;protocol&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vless&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;settings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;clients&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;UUID&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;flow&quot;</span><span class="token operator">:</span> <span class="token string">&quot;xtls-rprx-direct&quot;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;decryption&quot;</span><span class="token operator">:</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;fallbacks&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;example.com&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/vmessws&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;dest&quot;</span><span class="token operator">:</span> <span class="token number">5000</span><span class="token punctuation">,</span>
            <span class="token property">&quot;xver&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;dest&quot;</span><span class="token operator">:</span> <span class="token number">5001</span><span class="token punctuation">,</span>
            <span class="token property">&quot;xver&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;alpn&quot;</span><span class="token operator">:</span> <span class="token string">&quot;h2&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;dest&quot;</span><span class="token operator">:</span> <span class="token number">5002</span><span class="token punctuation">,</span>
            <span class="token property">&quot;xver&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;blog.example.com&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;dest&quot;</span><span class="token operator">:</span> <span class="token number">5003</span><span class="token punctuation">,</span>
            <span class="token property">&quot;xver&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;blog.example.com&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;alpn&quot;</span><span class="token operator">:</span> <span class="token string">&quot;h2&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;dest&quot;</span><span class="token operator">:</span> <span class="token number">5004</span><span class="token punctuation">,</span>
            <span class="token property">&quot;xver&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;streamSettings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;network&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tcp&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;security&quot;</span><span class="token operator">:</span> <span class="token string">&quot;xtls&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;xtlsSettings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;alpn&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;h2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http/1.1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token property">&quot;certificates&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
              <span class="token property">&quot;certificateFile&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/etc/ssl/xray/cert.pem&quot;</span><span class="token punctuation">,</span>
              <span class="token property">&quot;keyFile&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/etc/ssl/xray/privkey.key&quot;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;listen&quot;</span><span class="token operator">:</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">5000</span><span class="token punctuation">,</span>
      <span class="token property">&quot;protocol&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vmess&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;settings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;clients&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;UUID&quot;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;streamSettings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;network&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ws&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;wsSettings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;acceptProxyProtocol&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/vmessws&quot;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;outbounds&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;protocol&quot;</span><span class="token operator">:</span> <span class="token string">&quot;freedom&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br></div></div><p>以上配置针对于 Nginx，以下是需要注意的一些细节。</p><ul><li><p>有关 Proxy Protocol</p><p>Proxy Protocol 是 HaProxy 开发的一种旨在解决代理时容易丢失客户端信息问题的协议，常用于链式代理和反向代理。传统的处理方法往往较为复杂且有诸多限制，而 Proxy Protocol 非常简单地在传输数据时附带上原始连接四元组信息的数据包，解决了这个问题。</p><p>凡事皆有利弊，Proxy Protocol 也是如此。</p><ul><li>有发送必须有接收，反之亦然</li><li>同一端口不能既兼容带 Proxy Protocol 数据的连接又兼容不带数据的连接（如：Nginx 同端口的不同虚拟主机（server），本质是上一条）<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup><sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup></li></ul><p>在遇到异常时，请考虑配置是否符合上述条件。</p><p>此处，我们使用 Proxy Protocol 让被回落到的目标获取到客户端的真实 IP。</p><p>另外，当 Xray 的某个入站配置存在 <code>&quot;acceptProxyProtocol&quot;: true</code> 时，ReadV 将失效。</p></li><li><p>有关 HTTP/2</p><p>首先，<code>inbounds.streamSettings.xtlsSettings.alpn</code> 有顺序，应将 <code>h2</code> 放前，<code>http/1.1</code> 放后，在优先使用 HTTP/2 的同时保证兼容性；反过来会导致 HTTP/2 在协商时变为 HTTP/1.1，成为无效配置。</p><p>在上述配置中，每条回落到 Nginx 的配置都要分成两个。这是因为 h2 是强制 TLS 加密的 HTTP/2 连接，这有益于数据在互联网中传输的安全，但在服务器内部没有必要；而 h2c 是非加密的 HTTP/2 连接，适合该环境。然而，Nginx 不能在同一端口上同时监听 HTTP/1.1 和 h2c，为了解决这个问题，需要在回落中指定 <code>alpn</code> 项（是 <code>fallbacks</code> 而不是 <code>xtlsSettings</code> 里面的），以尝试匹配 TLS ALPN 协商结果。</p><p>建议 <code>alpn</code> 项只按需用两种填法：<sup class="footnote-ref"><a href="#fn4" id="fnref4">[4]</a></sup></p><ul><li>省略</li><li><code>&quot;h2&quot;</code></li></ul><p>如果使用 Caddy 就大可不必如此繁杂了，因为它<strong>可以</strong>在同一端口上同时监听 HTTP/1.1 和 h2c，配置改动如下：</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;fallbacks&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;example.com&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/vmessws&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;dest&quot;</span><span class="token operator">:</span> <span class="token number">5000</span><span class="token punctuation">,</span>
      <span class="token property">&quot;xver&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;dest&quot;</span><span class="token operator">:</span> <span class="token number">5001</span><span class="token punctuation">,</span>
      <span class="token property">&quot;xver&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;blog.example.com&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;dest&quot;</span><span class="token operator">:</span> <span class="token number">5002</span><span class="token punctuation">,</span>
      <span class="token property">&quot;xver&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div></li></ul><h2 id="nginx-配置" tabindex="-1"><a class="header-anchor" href="#nginx-配置" aria-hidden="true">#</a> Nginx 配置</h2><p>Nginx 将通过官方源进行安装。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token function">curl</span> gnupg2 ca-certificates lsb-release
<span class="token builtin class-name">echo</span> <span class="token string">&quot;deb [arch=amd64] http://nginx.org/packages/ubuntu <span class="token variable"><span class="token variable">`</span>lsb_release -cs<span class="token variable">`</span></span> nginx&quot;</span> <span class="token punctuation">\</span>
    <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /etc/apt/sources.list.d/nginx.list
<span class="token function">curl</span> -fsSL https://nginx.org/keys/nginx_signing.key <span class="token operator">|</span> <span class="token function">sudo</span> apt-key <span class="token function">add</span> -
<span class="token function">sudo</span> <span class="token function">apt</span> update
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> nginx
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>删除 <code>/etc/nginx/conf.d/default.conf</code> 并创建 <code>/etc/nginx/conf.d/fallbacks.conf</code>，内容如下：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">set_real_ip_from</span> 127.0.0.1</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">real_ip_header</span> proxy_protocol</span><span class="token punctuation">;</span>

<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> 127.0.0.1:5001 proxy_protocol default_server</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">listen</span> 127.0.0.1:5002 proxy_protocol default_server http2</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span> /srv/http/default</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> 127.0.0.1:5003 proxy_protocol</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">listen</span> 127.0.0.1:5004 proxy_protocol http2</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">server_name</span> blog.example.com</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span> /srv/http/blog.example.com</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">return</span> <span class="token number">301</span> https://<span class="token variable">$host</span><span class="token variable">$request_uri</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h2 id="caddy-配置" tabindex="-1"><a class="header-anchor" href="#caddy-配置" aria-hidden="true">#</a> Caddy 配置</h2><p>安装 Caddy 请参阅 <a href="https://caddyserver.com/docs/install" target="_blank" rel="noopener noreferrer">Install — Caddy Documentation<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>。</p><p>为了使 Caddy 能获取到访问者的真实 IP，需要编译带有 Proxy Protocol 模块的 Caddy。建议直接在 Caddy 官网上在线编译。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">curl</span> -o /usr/bin/caddy <span class="token string">&quot;https://caddyserver.com/api/download?os=linux&amp;arch=amd64&amp;p=github.com%2Fmastercactapus%2Fcaddy2-proxyprotocol&amp;idempotency=79074247675458&quot;</span>
<span class="token function">sudo</span> <span class="token function">chmod</span> +x /usr/bin/caddy
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>直接替换即可。</p><div class="custom-container tip"><p class="custom-container-title">提示</p><p>建议先通过官网文档安装 Caddy，再替换二进制文件。这样做无需手动设定进程守护。</p></div><p>编辑 <code>/etc/caddy/Caddyfile</code>：</p><div class="language-Caddyfile ext-Caddyfile line-numbers-mode"><pre class="language-Caddyfile"><code>{
    servers 127.0.0.1:5001 {
        listener_wrappers {
            proxy_protocol
        }
	protocol {
            allow_h2c
        }
    }
    servers 127.0.0.1:5002 {
        listener_wrappers {
            proxy_protocol
        }
	protocol {
            allow_h2c
        }
    }
}

:5001 {
    root * /srv/http/default
    file_server
    log
    bind 127.0.0.1
}

http://blog.example.com:5002 {
    root * /srv/http/blog.example.com
    file_server
    log
    bind 127.0.0.1
}

:80 {
    redir https://{host}{uri} permanent
}
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h2 id="参考" tabindex="-1"><a class="header-anchor" href="#参考" aria-hidden="true">#</a> 参考</h2><ol><li><a href="https://zh.wikipedia.org/wiki/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%90%8D%E7%A7%B0%E6%8C%87%E7%A4%BA" target="_blank" rel="noopener noreferrer">服务器名称指示 - 维基百科，自由的百科全书<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></li><li><a href="https://github.com/acmesh-official/acme.sh/wiki" target="_blank" rel="noopener noreferrer">Home · acmesh-official/acme.sh Wiki<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></li><li><a href="https://zh.wikipedia.org/wiki/HTTP/2" target="_blank" rel="noopener noreferrer">HTTP/2 - 维基百科，自由的百科全书<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></li></ol><h2 id="引用" tabindex="-1"><a class="header-anchor" href="#引用" aria-hidden="true">#</a> 引用</h2><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p><a href="https://letsencrypt.org/zh-cn/docs/faq/" target="_blank" rel="noopener noreferrer">常见问题 - Let&#39;s Encrypt - 免费的 SSL/TLS 证书<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> <a href="#fnref1" class="footnote-backref">↩︎</a></p></li><li id="fn2" class="footnote-item"><p><a href="https://www.haproxy.com/blog/haproxy/proxy-protocol/" target="_blank" rel="noopener noreferrer">Proxy Protocol - HAProxy Technologies<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> <a href="#fnref2" class="footnote-backref">↩︎</a></p></li><li id="fn3" class="footnote-item"><p><a href="https://www.jianshu.com/p/cc8d592582c9" target="_blank" rel="noopener noreferrer">proxy protocol 介绍及 nginx 配置 - 简书<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> <a href="#fnref3" class="footnote-backref">↩︎</a></p></li><li id="fn4" class="footnote-item"><p><a href="https://github.com/rprx/v2fly-github-io/blob/master/docs/config/protocols/vless.md" target="_blank" rel="noopener noreferrer">v2fly-github-io/vless.md at master · rprx/v2fly-github-io<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> <a href="#fnref4" class="footnote-backref">↩︎</a></p></li></ol></section><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="nav-link external meta-item-label" href="https://github.com/xtls/Xray-docs-next/edit/main/docs/document/level-1/fallbacks-with-sni.md" rel="noopener noreferrer" target="_blank" aria-label="帮助我们改善此页面！"><!--[--><!--]--> 帮助我们改善此页面！ <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">最近更改: </span><span class="meta-item-info">2021/7/15 16:29:22</span></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 50871214+JimhHan@users.noreply.github.com">JimhHan</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: 82594500+hmol233@users.noreply.github.com">hmol233</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"> ← <a href="/document/level-1/work.html" class="nav-link" aria-label="Xray 的工作模式"><!--[--><!--]--> Xray 的工作模式 <!--[--><!--]--></a></span><!----></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script src="/assets/js/runtime~app.89709ca3.js" defer></script><script src="/assets/js/3469.bd615835.js" defer></script><script src="/assets/js/app.776345c9.js" defer></script>
  </body>
</html>
