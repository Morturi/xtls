"use strict";(self.webpackChunkXray_docs_next=self.webpackChunkXray_docs_next||[]).push([[1393],{55749:(e,n,s)=>{s.r(n),s.d(n,{data:()=>a});const a={key:"v-2877542a",path:"/config/transports/grpc.html",title:"gRPC",lang:"zh-CN",frontmatter:{},excerpt:"",headers:[{level:2,title:"GRPCObject",slug:"grpcobject",children:[]}],filePathRelative:"config/transports/grpc.md",git:{updatedTime:1634840608e3,contributors:[{name:"Jim Han",email:"50871214+JimhHan@users.noreply.github.com",commits:7},{name:"JimhHan",email:"50871214+JimhHan@users.noreply.github.com",commits:3},{name:"xqzr",email:"34030394+xqzr@users.noreply.github.com",commits:3}]}}},84946:(e,n,s)=>{s.r(n),s.d(n,{default:()=>l});var a=s(66252);const t=(0,a.uE)('<h1 id="grpc" tabindex="-1"><a class="header-anchor" href="#grpc" aria-hidden="true">#</a> gRPC</h1><p>基于 gRPC 的传输方式。</p><p>它基于 HTTP/2 协议，理论上可以通过其它支持 HTTP/2 的服务器（如 Nginx）进行中转。 gRPC（HTTP/2）内置多路复用，不建议使用 gRPC 与 HTTP/2 时启用 mux.cool。</p><div class="custom-container warning"><p class="custom-container-title">⚠⚠⚠</p><ul><li>gRPC 不支持指定 Host。请在出站代理地址中填写 <strong>正确的域名</strong> ，或在 <code>(x)tlsSettings</code> 中填写 <code>ServerName</code>，否则无法连接。</li><li>gRPC 不支持回落到其他服务。</li><li>gRPC 服务存在被主动探测的风险。建议使用 Caddy 或 Nginx 等反向代理工具，通过 Path 前置分流。</li></ul></div><div class="custom-container tip"><p class="custom-container-title">提示</p><p>如果您使用 Caddy 或 Nginx 等反向代理，请注意下列事项：</p><ul><li>请确定反向代理服务器开启了 HTTP/2</li><li>请使用 HTTP/2 或 h2c (Caddy)，grpc_pass (Nginx) 连接到 Xray。</li><li>普通模式的 Path 为 <code>/${serviceName}/Tun</code>, Multi 模式为 <code>/${serviceName}/TunMulti</code></li></ul></div><div class="custom-container tip"><p class="custom-container-title">提示</p><p>如果你正在使用回落，请注意下列事项：</p><ul><li>不建议回落到 gRPC，存在被主动探测的风险。</li><li>请确认<code>h2</code> 位于 (x)tlsSettings.alpn 中的第一顺位，否则 gRPC（HTTP/2）可能无法完成 TLS 握手。</li><li>gRPC 无法通过进行 Path 分流。</li></ul></div><h2 id="grpcobject" tabindex="-1"><a class="header-anchor" href="#grpcobject" aria-hidden="true">#</a> GRPCObject</h2><p><code>GRPCObject</code> 对应传输配置的 <code>grpcSettings</code> 项。</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>\n  <span class="token property">&quot;serviceName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;multiMode&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;idle_timeout&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;health_check_timeout&quot;</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;permit_without_stream&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p><code>serviceName</code>: string</p></blockquote><p>一个字符串，指定服务名称，<strong>类似于</strong> HTTP/2 中的 Path。 客户端会使用此名称进行通信，服务端会验证服务名称是否匹配。</p>',11),o=(0,a._)("code",null,"multiMode",-1),c=(0,a.Uk)(": true | false "),p=(0,a.uE)("<p><code>true</code> 启用 <code>multiMode</code>，默认值为： <code>false</code>。</p><p>这是一个 <strong>实验性</strong> 选项，可能不会被长期保留，也不保证跨版本兼容。此模式在 <strong>测试环境中</strong> 能够带来约 20% 的性能提升，实际效果因传输速率不同而不同。</p><blockquote><p><code>idle_timeout</code>: number</p></blockquote><p>单位秒，当这段时间内没有数据传输时，将会进行健康检查。如果此值设置为 <code>10</code> 以下，将会使用 <code>10</code>，即最小值。</p><p>健康检查默认<strong>不启用</strong>。</p><p>仅需在<strong>客户端</strong>配置。</p><blockquote><p><code>health_check_timeout</code>: number</p></blockquote><p>单位秒，健康检查的超时时间。如果在这段时间内没有完成健康检查，且仍然没有数据传输时，即认为健康检查失败。默认值为 <code>20</code>。</p><blockquote><p><code>permit_without_stream</code>: true | false</p></blockquote><p><code>true</code> 允许在没有子连接时进行健康检查。默认值为 <code>false</code>。</p>",10),l={render:function(e,n){const s=(0,a.up)("Badge");return(0,a.wg)(),(0,a.iD)(a.HY,null,[t,(0,a._)("blockquote",null,[(0,a._)("p",null,[o,c,(0,a.Wm)(s,{text:"BETA",type:"warning"})])]),p],64)}}}}]);