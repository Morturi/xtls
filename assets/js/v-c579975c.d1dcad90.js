"use strict";(self.webpackChunkXray_docs_next=self.webpackChunkXray_docs_next||[]).push([[9139],{70632:(n,s,a)=>{a.r(s),a.d(s,{data:()=>t});const t={key:"v-c579975c",path:"/en/document/level-2/tproxy.html",title:"TProxy 透明代理",lang:"en-US",frontmatter:{title:"TProxy 透明代理"},excerpt:"",headers:[{level:2,title:"开始之前",slug:"开始之前",children:[]},{level:2,title:"Xray 配置",slug:"xray-配置",children:[]},{level:2,title:"策略路由配置",slug:"策略路由配置",children:[]},{level:2,title:"Netfilter 配置",slug:"netfilter-配置",children:[]},{level:2,title:"配置永久化与开机自启",slug:"配置永久化与开机自启",children:[]}],filePathRelative:"en/document/level-2/tproxy.md",git:{updatedTime:1678161692e3,contributors:[{name:"hmol233",email:"82594500+hmol233@users.noreply.github.com",commits:2},{name:"yuhan6665",email:"1588741+yuhan6665@users.noreply.github.com",commits:2}]}}},34074:(n,s,a)=>{a.r(s),a.d(s,{default:()=>P});var t=a(66252);const p=(0,t._)("h1",{id:"透明代理-tproxy-配置教程",tabindex:"-1"},[(0,t._)("a",{class:"header-anchor",href:"#透明代理-tproxy-配置教程","aria-hidden":"true"},"#"),(0,t.Uk)(" 透明代理（TProxy）配置教程")],-1),e=(0,t.Uk)("本配置基于"),o={href:"https://guide.v2fly.org/app/tproxy.html",target:"_blank",rel:"noopener noreferrer"},l=(0,t.Uk)("TProxy 透明代理的新 V2Ray 白话文教程"),r=(0,t.Uk)("，加入了 Xray 的新特性，使用 VLESS + XTLS Vision 方案，并将旧教程中默认出站代理的分流方式改为默认出站直连，使用者请按照实际情况进行修改。"),u=(0,t._)("p",null,"本文中所有配置已在 Raspberry Pi 2B、Ubuntu 20.04 环境下测试成功，如在其它环境中使用请自行调整配置。",-1),c=(0,t._)("h2",{id:"开始之前",tabindex:"-1"},[(0,t._)("a",{class:"header-anchor",href:"#开始之前","aria-hidden":"true"},"#"),(0,t.Uk)(" 开始之前")],-1),i=(0,t._)("p",null,"请检查您的设备是否有可用的网络连接，且服务端已经配置成功，客户端已经安装完毕。",-1),k=(0,t.Uk)("需注意的是，目前很多透明代理教程都会将 Linux 系统的 IP 转发打开，但这样会导致 Splice 性能下降。详情请参考"),b={href:"https://github.com/XTLS/Xray-core/discussions/59",target:"_blank",rel:"noopener noreferrer"},m=(0,t.Uk)("大案牍术破案纪实第三篇--我们是如何破解 Splice 性能下降甚至低于 Direct 之谜的"),_=(0,t.Uk)("。"),d=(0,t._)("p",null,"这里我想要补充的是，很多透明代理教程会使用 Netfilter 进行分流，使直连流量直接发出而不经过 Xray，这时必须开启 IP 转发；也有的教程，如本文，会将所有流量导入 Xray 之中，由 Xray 的路由模块进行分流，这时无需开启 IP 转发。",-1),q=(0,t._)("h2",{id:"xray-配置",tabindex:"-1"},[(0,t._)("a",{class:"header-anchor",href:"#xray-配置","aria-hidden":"true"},"#"),(0,t.Uk)(" Xray 配置")],-1),y=(0,t.Uk)("为了更好的分流体验，请替换默认路由规则文件为 "),g={href:"https://github.com/Loyalsoldier/v2ray-rules-dat",target:"_blank",rel:"noopener noreferrer"},U=(0,t.Uk)("Loyalsoldier/v2ray-rules-dat"),v=(0,t.Uk)("，否则 Xray-core 将无法加载本配置。"),f=(0,t.uE)('<div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">curl</span> -oL /usr/local/share/xray/geoip.dat https://github.com/Loyalsoldier/v2ray-rules-dat/releases/latest/download/geoip.dat\n<span class="token function">sudo</span> <span class="token function">curl</span> -oL /usr/local/share/xray/geosite.dat https://github.com/Loyalsoldier/v2ray-rules-dat/releases/latest/download/geosite.dat\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>\n  <span class="token property">&quot;log&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token property">&quot;loglevel&quot;</span><span class="token operator">:</span> <span class="token string">&quot;warning&quot;</span><span class="token punctuation">,</span>\n    <span class="token property">&quot;error&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/var/log/xray/error.log&quot;</span><span class="token punctuation">,</span>\n    <span class="token property">&quot;access&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/var/log/xray/access.log&quot;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;inbounds&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">{</span>\n      <span class="token property">&quot;tag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;all-in&quot;</span><span class="token punctuation">,</span>\n      <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">12345</span><span class="token punctuation">,</span>\n      <span class="token property">&quot;protocol&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dokodemo-door&quot;</span><span class="token punctuation">,</span>\n      <span class="token property">&quot;settings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n        <span class="token property">&quot;network&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tcp,udp&quot;</span><span class="token punctuation">,</span>\n        <span class="token property">&quot;followRedirect&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token property">&quot;sniffing&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n        <span class="token property">&quot;enabled&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n        <span class="token property">&quot;destOverride&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tls&quot;</span><span class="token punctuation">]</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token property">&quot;streamSettings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n        <span class="token property">&quot;sockopt&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n          <span class="token property">&quot;tproxy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tproxy&quot;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">]</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;outbounds&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">{</span>\n      <span class="token property">&quot;tag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;direct&quot;</span><span class="token punctuation">,</span>\n      <span class="token property">&quot;protocol&quot;</span><span class="token operator">:</span> <span class="token string">&quot;freedom&quot;</span><span class="token punctuation">,</span>\n      <span class="token property">&quot;settings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n        <span class="token property">&quot;domainStrategy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;UseIPv4&quot;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token property">&quot;streamSettings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n        <span class="token property">&quot;sockopt&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n          <span class="token property">&quot;mark&quot;</span><span class="token operator">:</span> <span class="token number">2</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">{</span>\n      <span class="token property">&quot;tag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;proxy&quot;</span><span class="token punctuation">,</span>\n      <span class="token property">&quot;protocol&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vless&quot;</span><span class="token punctuation">,</span>\n      <span class="token property">&quot;settings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n        <span class="token property">&quot;vnext&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n          <span class="token punctuation">{</span>\n            <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;服务端域名&quot;</span><span class="token punctuation">,</span>\n            <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">443</span><span class="token punctuation">,</span>\n            <span class="token property">&quot;users&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n              <span class="token punctuation">{</span>\n                <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;UUID&quot;</span><span class="token punctuation">,</span>\n                <span class="token property">&quot;flow&quot;</span><span class="token operator">:</span> <span class="token string">&quot;xtls-rprx-vision&quot;</span><span class="token punctuation">,</span>\n                <span class="token property">&quot;encryption&quot;</span><span class="token operator">:</span> <span class="token string">&quot;none&quot;</span>\n              <span class="token punctuation">}</span>\n            <span class="token punctuation">]</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">]</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token property">&quot;streamSettings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n        <span class="token property">&quot;network&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tcp&quot;</span><span class="token punctuation">,</span>\n        <span class="token property">&quot;security&quot;</span><span class="token operator">:</span> <span class="token string">&quot;xtls&quot;</span><span class="token punctuation">,</span>\n        <span class="token property">&quot;sockopt&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n          <span class="token property">&quot;mark&quot;</span><span class="token operator">:</span> <span class="token number">2</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">{</span>\n      <span class="token property">&quot;tag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;block&quot;</span><span class="token punctuation">,</span>\n      <span class="token property">&quot;protocol&quot;</span><span class="token operator">:</span> <span class="token string">&quot;blackhole&quot;</span><span class="token punctuation">,</span>\n      <span class="token property">&quot;settings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n        <span class="token property">&quot;response&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http&quot;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">{</span>\n      <span class="token property">&quot;tag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dns-out&quot;</span><span class="token punctuation">,</span>\n      <span class="token property">&quot;protocol&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dns&quot;</span><span class="token punctuation">,</span>\n      <span class="token property">&quot;settings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n        <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;8.8.8.8&quot;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token property">&quot;proxySettings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n        <span class="token property">&quot;tag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;proxy&quot;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token property">&quot;streamSettings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n        <span class="token property">&quot;sockopt&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n          <span class="token property">&quot;mark&quot;</span><span class="token operator">:</span> <span class="token number">2</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">]</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;dns&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token property">&quot;hosts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">&quot;服务端域名&quot;</span><span class="token operator">:</span> <span class="token string">&quot;服务端 IP&quot;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token property">&quot;servers&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n      <span class="token punctuation">{</span>\n        <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;119.29.29.29&quot;</span><span class="token punctuation">,</span>\n        <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">53</span><span class="token punctuation">,</span>\n        <span class="token property">&quot;domains&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;geosite:cn&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n        <span class="token property">&quot;expectIPs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;geoip:cn&quot;</span><span class="token punctuation">]</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n        <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;223.5.5.5&quot;</span><span class="token punctuation">,</span>\n        <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">53</span><span class="token punctuation">,</span>\n        <span class="token property">&quot;domains&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;geosite:cn&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n        <span class="token property">&quot;expectIPs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;geoip:cn&quot;</span><span class="token punctuation">]</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token string">&quot;8.8.8.8&quot;</span><span class="token punctuation">,</span>\n      <span class="token string">&quot;1.1.1.1&quot;</span><span class="token punctuation">,</span>\n      <span class="token string">&quot;https+local://doh.dns.sb/dns-query&quot;</span>\n    <span class="token punctuation">]</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;routing&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token property">&quot;domainStrategy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;IPIfNonMatch&quot;</span><span class="token punctuation">,</span>\n    <span class="token property">&quot;rules&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n      <span class="token punctuation">{</span>\n        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;field&quot;</span><span class="token punctuation">,</span>\n        <span class="token property">&quot;inboundTag&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;all-in&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n        <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">53</span><span class="token punctuation">,</span>\n        <span class="token property">&quot;outboundTag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dns-out&quot;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;field&quot;</span><span class="token punctuation">,</span>\n        <span class="token property">&quot;ip&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;8.8.8.8&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1.1.1.1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n        <span class="token property">&quot;outboundTag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;proxy&quot;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;field&quot;</span><span class="token punctuation">,</span>\n        <span class="token property">&quot;domain&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;geosite:category-ads-all&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n        <span class="token property">&quot;outboundTag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;block&quot;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;field&quot;</span><span class="token punctuation">,</span>\n        <span class="token property">&quot;domain&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;geosite:geolocation-!cn&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n        <span class="token property">&quot;outboundTag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;proxy&quot;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;field&quot;</span><span class="token punctuation">,</span>\n        <span class="token property">&quot;ip&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;geoip:telegram&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n        <span class="token property">&quot;outboundTag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;proxy&quot;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">]</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br></div></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>本配置会劫持所有发往 53 端口的流量以解决 DNS 污染问题，所以客户端和本机的 DNS 服务器的地址可以随意配置。</p></div><h2 id="策略路由配置" tabindex="-1"><a class="header-anchor" href="#策略路由配置" aria-hidden="true">#</a> 策略路由配置</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sudo ip route add local default dev lo table 100 # 添加路由表 100\nsudo ip rule add fwmark 1 table 100 # 为路由表 100 设定规则\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="netfilter-配置" tabindex="-1"><a class="header-anchor" href="#netfilter-配置" aria-hidden="true">#</a> Netfilter 配置</h2><div class="custom-container warning"><p class="custom-container-title">注意</p><p>nftables 配置与 iptables 配置二选一，不可同时使用。</p></div>',7),h=(0,t._)("div",{class:"language-nftables ext-nftables line-numbers-mode"},[(0,t._)("pre",{class:"language-nftables"},[(0,t._)("code",null,"#!/usr/sbin/nft -f\n\nflush ruleset\n\ndefine RESERVED_IP = {\n    10.0.0.0/8,\n    100.64.0.0/10,\n    127.0.0.0/8,\n    169.254.0.0/16,\n    172.16.0.0/12,\n    192.0.0.0/24,\n    224.0.0.0/4,\n    240.0.0.0/4,\n    255.255.255.255/32\n}\n\ntable ip xray {\n        chain prerouting {\n                type filter hook prerouting priority mangle; policy accept;\n                ip daddr $RESERVED_IP return\n                ip daddr 192.168.0.0/16 tcp dport != 53 return\n                ip daddr 192.168.0.0/16 udp dport != 53 return\n                ip protocol tcp tproxy to 127.0.0.1:12345 meta mark set 1\n                ip protocol udp tproxy to 127.0.0.1:12345 meta mark set 1\n        }\n        chain output {\n                type route hook output priority mangle; policy accept;\n                ip daddr $RESERVED_IP return\n                ip daddr 192.168.0.0/16 tcp dport != 53 return\n                ip daddr 192.168.0.0/16 udp dport != 53 return\n                meta mark 2 return\n                ip protocol tcp meta mark set 1\n                ip protocol udp meta mark set 1\n        }\n}\n")]),(0,t._)("div",{class:"line-numbers"},[(0,t._)("span",{class:"line-number"},"1"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"2"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"3"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"4"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"5"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"6"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"7"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"8"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"9"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"10"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"11"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"12"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"13"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"14"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"15"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"16"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"17"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"18"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"19"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"20"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"21"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"22"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"23"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"24"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"25"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"26"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"27"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"28"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"29"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"30"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"31"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"32"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"33"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"34"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"35"),(0,t._)("br")])],-1),R=(0,t._)("div",{class:"custom-container tip"},[(0,t._)("p",{class:"custom-container-title"},"使用方法"),(0,t._)("p",null,[(0,t.Uk)("将上述配置写入一个文件（如 "),(0,t._)("code",null,"nft.conf"),(0,t.Uk)("），之后将该文件赋予可执行权限，最后使用 root 权限执行该文件即可（"),(0,t._)("code",null,"# ./nft.conf"),(0,t.Uk)("）。")])],-1),A=(0,t._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,t._)("pre",{class:"language-bash"},[(0,t._)("code",null,[(0,t.Uk)("iptables -t mangle -N XRAY\niptables -t mangle -A XRAY -d "),(0,t._)("span",{class:"token number"},"10.0"),(0,t.Uk)(".0.0/8 -j RETURN\niptables -t mangle -A XRAY -d "),(0,t._)("span",{class:"token number"},"100.64"),(0,t.Uk)(".0.0/10 -j RETURN\niptables -t mangle -A XRAY -d "),(0,t._)("span",{class:"token number"},"127.0"),(0,t.Uk)(".0.0/8 -j RETURN\niptables -t mangle -A XRAY -d "),(0,t._)("span",{class:"token number"},"169.254"),(0,t.Uk)(".0.0/16 -j RETURN\niptables -t mangle -A XRAY -d "),(0,t._)("span",{class:"token number"},"172.16"),(0,t.Uk)(".0.0/12 -j RETURN\niptables -t mangle -A XRAY -d "),(0,t._)("span",{class:"token number"},"192.0"),(0,t.Uk)(".0.0/24 -j RETURN\niptables -t mangle -A XRAY -d "),(0,t._)("span",{class:"token number"},"224.0"),(0,t.Uk)(".0.0/4 -j RETURN\niptables -t mangle -A XRAY -d "),(0,t._)("span",{class:"token number"},"240.0"),(0,t.Uk)(".0.0/4 -j RETURN\niptables -t mangle -A XRAY -d "),(0,t._)("span",{class:"token number"},"255.255"),(0,t.Uk)(".255.255/32 -j RETURN\niptables -t mangle -A XRAY -d "),(0,t._)("span",{class:"token number"},"192.168"),(0,t.Uk)(".0.0/16 -p tcp "),(0,t._)("span",{class:"token operator"},"!"),(0,t.Uk)(" --dport "),(0,t._)("span",{class:"token number"},"53"),(0,t.Uk)(" -j RETURN\niptables -t mangle -A XRAY -d "),(0,t._)("span",{class:"token number"},"192.168"),(0,t.Uk)(".0.0/16 -p udp "),(0,t._)("span",{class:"token operator"},"!"),(0,t.Uk)(" --dport "),(0,t._)("span",{class:"token number"},"53"),(0,t.Uk)(" -j RETURN\niptables -t mangle -A XRAY -p tcp -j TPROXY --on-port "),(0,t._)("span",{class:"token number"},"12345"),(0,t.Uk)(" --tproxy-mark "),(0,t._)("span",{class:"token number"},"1"),(0,t.Uk)("\niptables -t mangle -A XRAY -p udp -j TPROXY --on-port "),(0,t._)("span",{class:"token number"},"12345"),(0,t.Uk)(" --tproxy-mark "),(0,t._)("span",{class:"token number"},"1"),(0,t.Uk)("\niptables -t mangle -A PREROUTING -j XRAY\n\niptables -t mangle -N XRAY_SELF\niptables -t mangle -A XRAY_SELF -d "),(0,t._)("span",{class:"token number"},"10.0"),(0,t.Uk)(".0.0/8 -j RETURN\niptables -t mangle -A XRAY_SELF -d "),(0,t._)("span",{class:"token number"},"100.64"),(0,t.Uk)(".0.0/10 -j RETURN\niptables -t mangle -A XRAY_SELF -d "),(0,t._)("span",{class:"token number"},"127.0"),(0,t.Uk)(".0.0/8 -j RETURN\niptables -t mangle -A XRAY_SELF -d "),(0,t._)("span",{class:"token number"},"169.254"),(0,t.Uk)(".0.0/16 -j RETURN\niptables -t mangle -A XRAY_SELF -d "),(0,t._)("span",{class:"token number"},"172.16"),(0,t.Uk)(".0.0/12 -j RETURN\niptables -t mangle -A XRAY_SELF -d "),(0,t._)("span",{class:"token number"},"192.0"),(0,t.Uk)(".0.0/24 -j RETURN\niptables -t mangle -A XRAY_SELF -d "),(0,t._)("span",{class:"token number"},"224.0"),(0,t.Uk)(".0.0/4 -j RETURN\niptables -t mangle -A XRAY_SELF -d "),(0,t._)("span",{class:"token number"},"240.0"),(0,t.Uk)(".0.0/4 -j RETURN\niptables -t mangle -A XRAY_SELF -d "),(0,t._)("span",{class:"token number"},"255.255"),(0,t.Uk)(".255.255/32 -j RETURN\niptables -t mangle -A XRAY_SELF -d "),(0,t._)("span",{class:"token number"},"192.168"),(0,t.Uk)(".0.0/16 -p tcp "),(0,t._)("span",{class:"token operator"},"!"),(0,t.Uk)(" --dport "),(0,t._)("span",{class:"token number"},"53"),(0,t.Uk)(" -j RETURN\niptables -t mangle -A XRAY_SELF -d "),(0,t._)("span",{class:"token number"},"192.168"),(0,t.Uk)(".0.0/16 -p udp "),(0,t._)("span",{class:"token operator"},"!"),(0,t.Uk)(" --dport "),(0,t._)("span",{class:"token number"},"53"),(0,t.Uk)(" -j RETURN\niptables -t mangle -A XRAY_SELF -m mark --mark "),(0,t._)("span",{class:"token number"},"2"),(0,t.Uk)(" -j RETURN\niptables -t mangle -A XRAY_SELF -p tcp -j MARK --set-mark "),(0,t._)("span",{class:"token number"},"1"),(0,t.Uk)("\niptables -t mangle -A XRAY_SELF -p udp -j MARK --set-mark "),(0,t._)("span",{class:"token number"},"1"),(0,t.Uk)("\niptables -t mangle -A OUTPUT -j XRAY_SELF\n")])]),(0,t._)("div",{class:"line-numbers"},[(0,t._)("span",{class:"line-number"},"1"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"2"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"3"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"4"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"5"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"6"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"7"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"8"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"9"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"10"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"11"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"12"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"13"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"14"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"15"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"16"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"17"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"18"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"19"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"20"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"21"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"22"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"23"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"24"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"25"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"26"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"27"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"28"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"29"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"30"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"31"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"32"),(0,t._)("br")])],-1),x=(0,t._)("p",null,"配置完成后，将局域网内其它设备的默认网关改为该设备 IP，就可以直接翻墙了。在其它主机和本机皆测试成功后，可进行下一步配置。",-1),E=(0,t._)("h2",{id:"配置永久化与开机自启",tabindex:"-1"},[(0,t._)("a",{class:"header-anchor",href:"#配置永久化与开机自启","aria-hidden":"true"},"#"),(0,t.Uk)(" 配置永久化与开机自启")],-1),T=(0,t._)("br",null,null,-1),X=(0,t._)("p",null,[(0,t.Uk)("首先将已经编辑好的 nftables 配置文件移动到 "),(0,t._)("code",null,"/etc"),(0,t.Uk)(" 目录下，并重命名为 "),(0,t._)("code",null,"nftables.conf"),(0,t.Uk)("。然后编辑 "),(0,t._)("code",null,"/lib/systemd/system/nftables.service"),(0,t.Uk)("。")],-1),S=(0,t._)("div",{class:"language-ini ext-ini line-numbers-mode"},[(0,t._)("pre",{class:"language-ini"},[(0,t._)("code",null,[(0,t._)("span",{class:"token header"},[(0,t._)("span",{class:"token punctuation"},"["),(0,t._)("span",{class:"token section-name selector"},"Unit"),(0,t._)("span",{class:"token punctuation"},"]")]),(0,t.Uk)("\n"),(0,t._)("span",{class:"token key attr-name"},"Description"),(0,t._)("span",{class:"token punctuation"},"="),(0,t._)("span",{class:"token value attr-value"},"nftables"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token key attr-name"},"Documentation"),(0,t._)("span",{class:"token punctuation"},"="),(0,t._)("span",{class:"token value attr-value"},"man:nft(8) http://wiki.nftables.org"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token key attr-name"},"Wants"),(0,t._)("span",{class:"token punctuation"},"="),(0,t._)("span",{class:"token value attr-value"},"network-pre.target"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token key attr-name"},"Before"),(0,t._)("span",{class:"token punctuation"},"="),(0,t._)("span",{class:"token value attr-value"},"network-pre.target shutdown.target"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token key attr-name"},"Conflicts"),(0,t._)("span",{class:"token punctuation"},"="),(0,t._)("span",{class:"token value attr-value"},"shutdown.target"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token key attr-name"},"DefaultDependencies"),(0,t._)("span",{class:"token punctuation"},"="),(0,t._)("span",{class:"token value attr-value"},"no"),(0,t.Uk)("\n\n"),(0,t._)("span",{class:"token header"},[(0,t._)("span",{class:"token punctuation"},"["),(0,t._)("span",{class:"token section-name selector"},"Service"),(0,t._)("span",{class:"token punctuation"},"]")]),(0,t.Uk)("\n"),(0,t._)("span",{class:"token key attr-name"},"Type"),(0,t._)("span",{class:"token punctuation"},"="),(0,t._)("span",{class:"token value attr-value"},"oneshot"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token key attr-name"},"RemainAfterExit"),(0,t._)("span",{class:"token punctuation"},"="),(0,t._)("span",{class:"token value attr-value"},"yes"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token key attr-name"},"StandardInput"),(0,t._)("span",{class:"token punctuation"},"="),(0,t._)("span",{class:"token value attr-value"},"null"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token key attr-name"},"ProtectSystem"),(0,t._)("span",{class:"token punctuation"},"="),(0,t._)("span",{class:"token value attr-value"},"full"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token key attr-name"},"ProtectHome"),(0,t._)("span",{class:"token punctuation"},"="),(0,t._)("span",{class:"token value attr-value"},"true"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token key attr-name"},"ExecStart"),(0,t._)("span",{class:"token punctuation"},"="),(0,t._)("span",{class:"token value attr-value"},"/usr/sbin/nft -f /etc/nftables.conf ; /usr/sbin/ip route add local default dev lo table 100 ; /usr/sbin/ip rule add fwmark 1 table 100"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token key attr-name"},"ExecReload"),(0,t._)("span",{class:"token punctuation"},"="),(0,t._)("span",{class:"token value attr-value"},"/usr/sbin/nft -f /etc/nftables.conf"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token key attr-name"},"ExecStop"),(0,t._)("span",{class:"token punctuation"},"="),(0,t._)("span",{class:"token value attr-value"},"/usr/sbin/nft flush ruleset ; /usr/sbin/ip route del local default dev lo table 100 ; /usr/sbin/ip rule del table 100"),(0,t.Uk)("\n\n"),(0,t._)("span",{class:"token header"},[(0,t._)("span",{class:"token punctuation"},"["),(0,t._)("span",{class:"token section-name selector"},"Install"),(0,t._)("span",{class:"token punctuation"},"]")]),(0,t.Uk)("\n"),(0,t._)("span",{class:"token key attr-name"},"WantedBy"),(0,t._)("span",{class:"token punctuation"},"="),(0,t._)("span",{class:"token value attr-value"},"sysinit.target"),(0,t.Uk)("\n")])]),(0,t._)("div",{class:"line-numbers"},[(0,t._)("span",{class:"line-number"},"1"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"2"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"3"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"4"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"5"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"6"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"7"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"8"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"9"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"10"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"11"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"12"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"13"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"14"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"15"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"16"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"17"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"18"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"19"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"20"),(0,t._)("br")])],-1),Y=(0,t._)("p",null,"最后 enable 即可。",-1),j=(0,t._)("p",null,[(0,t.Uk)("关于 iptables 的永久化，建议直接安装 "),(0,t._)("code",null,"iptables-persistent"),(0,t.Uk)("。")],-1),N=(0,t._)("p",null,[(0,t.Uk)("安装过程中会提示你选择“是否保存配置”，如果已经将 iptables 配置写入系统，那么此时选择“是”即可；如果尚未写入也没有关系，安装完毕后将配置写入，然后执行 "),(0,t._)("code",null,"netfilter-persistent save"),(0,t.Uk)(" 即可（需要 root 权限）。")],-1),w=(0,t._)("p",null,[(0,t.Uk)("之后编辑 "),(0,t._)("code",null,"/lib/systemd/system/netfilter-persistent.service"),(0,t.Uk)("。")],-1),L=(0,t._)("div",{class:"language-ini ext-ini line-numbers-mode"},[(0,t._)("pre",{class:"language-ini"},[(0,t._)("code",null,[(0,t._)("span",{class:"token header"},[(0,t._)("span",{class:"token punctuation"},"["),(0,t._)("span",{class:"token section-name selector"},"Unit"),(0,t._)("span",{class:"token punctuation"},"]")]),(0,t.Uk)("\n"),(0,t._)("span",{class:"token key attr-name"},"Description"),(0,t._)("span",{class:"token punctuation"},"="),(0,t._)("span",{class:"token value attr-value"},"netfilter persistent configuration"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token key attr-name"},"DefaultDependencies"),(0,t._)("span",{class:"token punctuation"},"="),(0,t._)("span",{class:"token value attr-value"},"no"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token key attr-name"},"Wants"),(0,t._)("span",{class:"token punctuation"},"="),(0,t._)("span",{class:"token value attr-value"},"network-pre.target systemd-modules-load.service local-fs.target"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token key attr-name"},"Before"),(0,t._)("span",{class:"token punctuation"},"="),(0,t._)("span",{class:"token value attr-value"},"network-pre.target shutdown.target"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token key attr-name"},"After"),(0,t._)("span",{class:"token punctuation"},"="),(0,t._)("span",{class:"token value attr-value"},"systemd-modules-load.service local-fs.target"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token key attr-name"},"Conflicts"),(0,t._)("span",{class:"token punctuation"},"="),(0,t._)("span",{class:"token value attr-value"},"shutdown.target"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token key attr-name"},"Documentation"),(0,t._)("span",{class:"token punctuation"},"="),(0,t._)("span",{class:"token value attr-value"},"man:netfilter-persistent(8)"),(0,t.Uk)("\n\n"),(0,t._)("span",{class:"token header"},[(0,t._)("span",{class:"token punctuation"},"["),(0,t._)("span",{class:"token section-name selector"},"Service"),(0,t._)("span",{class:"token punctuation"},"]")]),(0,t.Uk)("\n"),(0,t._)("span",{class:"token key attr-name"},"Type"),(0,t._)("span",{class:"token punctuation"},"="),(0,t._)("span",{class:"token value attr-value"},"oneshot"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token key attr-name"},"RemainAfterExit"),(0,t._)("span",{class:"token punctuation"},"="),(0,t._)("span",{class:"token value attr-value"},"yes"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token key attr-name"},"ExecStart"),(0,t._)("span",{class:"token punctuation"},"="),(0,t._)("span",{class:"token value attr-value"},"/usr/sbin/netfilter-persistent start ; /usr/sbin/ip route add local default dev lo table 100 ; /usr/sbin/ip rule add fwmark 1 table 100"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token key attr-name"},"ExecStop"),(0,t._)("span",{class:"token punctuation"},"="),(0,t._)("span",{class:"token value attr-value"},"/usr/sbin/netfilter-persistent stop ; /usr/sbin/ip route flush dev lo table 100 ; /usr/sbin/ip rule del table 100"),(0,t.Uk)("\n\n"),(0,t._)("span",{class:"token header"},[(0,t._)("span",{class:"token punctuation"},"["),(0,t._)("span",{class:"token section-name selector"},"Install"),(0,t._)("span",{class:"token punctuation"},"]")]),(0,t.Uk)("\n"),(0,t._)("span",{class:"token key attr-name"},"WantedBy"),(0,t._)("span",{class:"token punctuation"},"="),(0,t._)("span",{class:"token value attr-value"},"multi-user.target"),(0,t.Uk)("\n")])]),(0,t._)("div",{class:"line-numbers"},[(0,t._)("span",{class:"line-number"},"1"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"2"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"3"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"4"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"5"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"6"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"7"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"8"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"9"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"10"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"11"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"12"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"13"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"14"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"15"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"16"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"17"),(0,t._)("br")])],-1),P={render:function(n,s){const a=(0,t.up)("OutboundLink"),P=(0,t.up)("Tab"),I=(0,t.up)("Tabs");return(0,t.wg)(),(0,t.iD)(t.HY,null,[p,(0,t._)("p",null,[e,(0,t._)("a",o,[l,(0,t.Wm)(a)]),r]),u,c,i,(0,t._)("p",null,[k,(0,t._)("a",b,[m,(0,t.Wm)(a)]),_]),d,q,(0,t._)("p",null,[y,(0,t._)("a",g,[U,(0,t.Wm)(a)]),v]),f,(0,t.Wm)(I,{title:"netfilter"},{default:(0,t.w5)((()=>[(0,t.Wm)(P,{title:"nftables1"},{default:(0,t.w5)((()=>[h,R])),_:1}),(0,t.Wm)(P,{title:"iptables1"},{default:(0,t.w5)((()=>[A])),_:1})])),_:1}),x,E,T,(0,t.Wm)(I,{title:"netfilter2"},{default:(0,t.w5)((()=>[(0,t.Wm)(P,{title:"nftables2"},{default:(0,t.w5)((()=>[X,S,Y])),_:1}),(0,t.Wm)(P,{title:"iptables2"},{default:(0,t.w5)((()=>[j,N,w,L])),_:1})])),_:1})],64)}}}}]);