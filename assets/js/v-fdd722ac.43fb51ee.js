"use strict";(self.webpackChunkXray_docs_next=self.webpackChunkXray_docs_next||[]).push([[6271],{9669:(n,s,l)=>{l.r(s),l.d(s,{data:()=>a});const a={key:"v-fdd722ac",path:"/document/level-1/routing-lv1-part1.html",title:"路由 (routing) 功能简析（上）",lang:"zh-CN",frontmatter:{},excerpt:"",headers:[{level:2,title:"1. 初识【路由】三兄弟",slug:"_1-初识【路由】三兄弟",children:[]},{level:2,title:"2. 基本功： “兄弟一条心”",slug:"_2-基本功-兄弟一条心",children:[{level:3,title:"2.1 入站",slug:"_2-1-入站",children:[]},{level:3,title:"2.3 路由",slug:"_2-3-路由",children:[]},{level:3,title:"2.4 路由配置项解析之一：流量筛选的依据",slug:"_2-4-路由配置项解析之一-流量筛选的依据",children:[]}]},{level:2,title:"3. 小试牛刀： “三分天下” 之 “域名分流”",slug:"_3-小试牛刀-三分天下-之-域名分流",children:[{level:3,title:"3.1 入站",slug:"_3-1-入站",children:[]},{level:3,title:"3.2 出站",slug:"_3-2-出站",children:[]},{level:3,title:"3.3 路由",slug:"_3-3-路由",children:[]},{level:3,title:"3.4 简析域名文件： geosite.dat",slug:"_3-4-简析域名文件-geosite-dat",children:[]},{level:3,title:"3.5 所以 geosite.dat 到底是什么？不是有个 GFWList 吗？",slug:"_3-5-所以-geosite-dat-到底是什么-不是有个-gfwlist-吗",children:[]},{level:3,title:"3.6 军师锦囊藏奇兵：一条隐藏的路由规则",slug:"_3-6-军师锦囊藏奇兵-一条隐藏的路由规则",children:[]},{level:3,title:"3.7 再看“三分天下”的大地图",slug:"_3-7-再看-三分天下-的大地图",children:[]}]},{level:2,title:"4. “三分天下” 之 “蜀魏争雄”",slug:"_4-三分天下-之-蜀魏争雄",children:[]},{level:2,title:"5. 攻城略池 - 多种路由匹配条件",slug:"_5-攻城略池-多种路由匹配条件",children:[]}],filePathRelative:"document/level-1/routing-lv1-part1.md",git:{updatedTime:1672074762e3,contributors:[{name:"JimhHan",email:"50871214+JimhHan@users.noreply.github.com",commits:3},{name:"hmol233",email:"82594500+hmol233@users.noreply.github.com",commits:2},{name:"RouRouX",email:"9323294@qq.com",commits:1},{name:"yuhan6665",email:"1588741+yuhan6665@users.noreply.github.com",commits:1}]}}},4736:(n,s,l)=>{l.r(s),l.d(s,{default:()=>Fs});var a=l(6252),e=l(7832);const t=(0,a._)("h1",{id:"路由-routing-功能简析-上",tabindex:"-1"},[(0,a._)("a",{class:"header-anchor",href:"#路由-routing-功能简析-上","aria-hidden":"true"},"#"),(0,a.Uk)(" 路由 (routing) 功能简析（上）")],-1),o=(0,a._)("p",null,"如果说 Xray 的【强大】主要体现在它极致的速度和广泛的兼容性。那么 Xray 的【灵活】，则主要应该归功于它巧妙的【路由】功能。本文就稍微说明一下这个功能的逻辑以及使用方式。",-1),r=(0,a._)("h2",{id:"_1-初识【路由】三兄弟",tabindex:"-1"},[(0,a._)("a",{class:"header-anchor",href:"#_1-初识【路由】三兄弟","aria-hidden":"true"},"#"),(0,a.Uk)(" 1. 初识【路由】三兄弟")],-1),_=(0,a._)("p",null,[(0,a.Uk)("要理解路由，就要理解完整的路由功能需要有三兄弟来合力完成：1. "),(0,a._)("strong",null,"入站"),(0,a.Uk)("；2. "),(0,a._)("strong",null,"路由"),(0,a.Uk)("；3. "),(0,a._)("strong",null,"出站"),(0,a.Uk)("。")],-1),c=(0,a._)("p",null,[(0,a._)("img",{src:e,alt:"路由三兄弟"})],-1),p=(0,a._)("p",null,"三兄弟桃园结义，不求同年同月同日生，但求同年同月同日死。",-1),u=(0,a._)("p",null,"所以谨记：任何一个元素错误，就可能导致路由功能无法正常工作。",-1),i=(0,a._)("p",null,"因为路由的灵活性非常高，只看技术文档很容易把自己绕晕，所以本文我们用几个具体的示例来逐层讲解。",-1),k=(0,a._)("div",{class:"custom-container warning"},[(0,a._)("p",{class:"custom-container-title"},"啰嗦君"),(0,a._)("p",null,"路由功能实在过于灵活，所以本文的示例，都是为了讲解对应的概念，实际使用时请根据自己的需求进行调整。")],-1),d=(0,a._)("h2",{id:"_2-基本功-兄弟一条心",tabindex:"-1"},[(0,a._)("a",{class:"header-anchor",href:"#_2-基本功-兄弟一条心","aria-hidden":"true"},"#"),(0,a.Uk)(" 2. 基本功： “兄弟一条心”")],-1),U=(0,a._)("p",null,[(0,a.Uk)("下图的示例，就是在客户端的 "),(0,a._)("code",null,"Xray"),(0,a.Uk)(" 入站接收 APP 数据、在路由 100%转发给出站，并从出站流向 VPS。")],-1),b=(0,a._)("p",null,"下面我们来逐个分析：",-1),g=(0,a._)("h3",{id:"_2-1-入站",tabindex:"-1"},[(0,a._)("a",{class:"header-anchor",href:"#_2-1-入站","aria-hidden":"true"},"#"),(0,a.Uk)(" 2.1 入站")],-1),m=(0,a._)("div",{class:"custom-container tip"},[(0,a._)("p",{class:"custom-container-title"},"提示"),(0,a._)("p",null,[(0,a._)("strong",null,"入站："),(0,a.Uk)(" 就是流量如何流入 "),(0,a._)("code",null,"Xray")])],-1),y=(0,a._)("p",null,[(0,a.Uk)("下面的入站配置示例，用大白话说就是：数据按照 "),(0,a._)("code",null,"socks"),(0,a.Uk)(" 协议，通过 "),(0,a._)("code",null,"10808"),(0,a.Uk)(" 端口，从本机 "),(0,a._)("code",null,"127.0.0.1"),(0,a.Uk)(" 流入"),(0,a._)("code",null,"Xray"),(0,a.Uk)("。同时，"),(0,a._)("code",null,"Xray"),(0,a.Uk)(" 将这个入站用 "),(0,a._)("code",null,"[tag]"),(0,a.Uk)(" 命名为 "),(0,a._)("code",null,"inbound-10808"),(0,a.Uk)("。")],-1),A=(0,a._)("div",{class:"language-json ext-json line-numbers-mode"},[(0,a._)("pre",{class:"language-json"},[(0,a._)("code",null,[(0,a._)("span",{class:"token punctuation"},"{"),(0,a.Uk)("\n  "),(0,a._)("span",{class:"token property"},'"inbounds"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token punctuation"},"["),(0,a.Uk)("\n    "),(0,a._)("span",{class:"token punctuation"},"{"),(0,a.Uk)("\n      "),(0,a._)("span",{class:"token property"},'"tag"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token string"},'"inbound-10808"'),(0,a._)("span",{class:"token punctuation"},","),(0,a.Uk)("\n      "),(0,a._)("span",{class:"token property"},'"protocol"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token string"},'"socks"'),(0,a._)("span",{class:"token punctuation"},","),(0,a.Uk)("\n      "),(0,a._)("span",{class:"token property"},'"listen"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token string"},'"127.0.0.1"'),(0,a._)("span",{class:"token punctuation"},","),(0,a.Uk)("\n      "),(0,a._)("span",{class:"token property"},'"port"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token number"},"10808"),(0,a._)("span",{class:"token punctuation"},","),(0,a.Uk)("\n      "),(0,a._)("span",{class:"token property"},'"settings"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token punctuation"},"{"),(0,a.Uk)("\n        "),(0,a._)("span",{class:"token property"},'"udp"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token boolean"},"true"),(0,a.Uk)("\n      "),(0,a._)("span",{class:"token punctuation"},"}"),(0,a.Uk)("\n    "),(0,a._)("span",{class:"token punctuation"},"}"),(0,a.Uk)("\n  "),(0,a._)("span",{class:"token punctuation"},"]"),(0,a.Uk)("\n"),(0,a._)("span",{class:"token punctuation"},"}"),(0,a.Uk)("\n")])]),(0,a._)("div",{class:"line-numbers"},[(0,a._)("span",{class:"line-number"},"1"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"2"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"3"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"4"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"5"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"6"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"7"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"8"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"9"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"10"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"11"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"12"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"13"),(0,a._)("br")])],-1),h=(0,a._)("p",null,[(0,a._)("strong",null,"2.2 出站")],-1),E=(0,a._)("div",{class:"custom-container tip"},[(0,a._)("p",{class:"custom-container-title"},"提示"),(0,a._)("p",null,[(0,a._)("strong",null,"出站："),(0,a.Uk)(" 就是流量如何流出 "),(0,a._)("code",null,"Xray")])],-1),f=(0,a._)("p",null,[(0,a.Uk)("下面的出站配置示例，用大白话说就是：数据按照 "),(0,a._)("code",null,"VLESS"),(0,a.Uk)(" 协议，以 "),(0,a._)("code",null,"tcp + xtls"),(0,a.Uk)(" 的方式、及其他相关设置，把流量发送给对应的 VPS。同时，"),(0,a._)("code",null,"Xray"),(0,a.Uk)(" 将这个出站用 "),(0,a._)("code",null,"[tag]"),(0,a.Uk)(" 命名为 "),(0,a._)("code",null,"proxy-out-vless"),(0,a.Uk)("：")],-1),B=(0,a._)("div",{class:"language-json ext-json line-numbers-mode"},[(0,a._)("pre",{class:"language-json"},[(0,a._)("code",null,[(0,a._)("span",{class:"token punctuation"},"{"),(0,a.Uk)("\n  "),(0,a._)("span",{class:"token property"},'"outbounds"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token punctuation"},"["),(0,a.Uk)("\n    "),(0,a._)("span",{class:"token punctuation"},"{"),(0,a.Uk)("\n      "),(0,a._)("span",{class:"token property"},'"tag"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token string"},'"proxy-out-vless"'),(0,a._)("span",{class:"token punctuation"},","),(0,a.Uk)("\n      "),(0,a._)("span",{class:"token property"},'"protocol"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token string"},'"vless"'),(0,a._)("span",{class:"token punctuation"},","),(0,a.Uk)("\n      "),(0,a._)("span",{class:"token property"},'"settings"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token punctuation"},"{"),(0,a.Uk)("\n        "),(0,a._)("span",{class:"token property"},'"vnext"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token punctuation"},"["),(0,a.Uk)("\n          "),(0,a._)("span",{class:"token punctuation"},"{"),(0,a.Uk)("\n            "),(0,a._)("span",{class:"token property"},'"address"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token string"},'"a-name.yourdomain.com"'),(0,a._)("span",{class:"token punctuation"},","),(0,a.Uk)("\n            "),(0,a._)("span",{class:"token property"},'"port"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token number"},"443"),(0,a._)("span",{class:"token punctuation"},","),(0,a.Uk)("\n            "),(0,a._)("span",{class:"token property"},'"users"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token punctuation"},"["),(0,a.Uk)("\n              "),(0,a._)("span",{class:"token punctuation"},"{"),(0,a.Uk)("\n                "),(0,a._)("span",{class:"token property"},'"id"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token string"},'"uuiduuid-uuid-uuid-uuid-uuiduuiduuid"'),(0,a._)("span",{class:"token punctuation"},","),(0,a.Uk)("\n                "),(0,a._)("span",{class:"token property"},'"flow"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token string"},'"xtls-rprx-vision"'),(0,a._)("span",{class:"token punctuation"},","),(0,a.Uk)("\n                "),(0,a._)("span",{class:"token property"},'"encryption"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token string"},'"none"'),(0,a._)("span",{class:"token punctuation"},","),(0,a.Uk)("\n                "),(0,a._)("span",{class:"token property"},'"level"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token number"},"0"),(0,a.Uk)("\n              "),(0,a._)("span",{class:"token punctuation"},"}"),(0,a.Uk)("\n            "),(0,a._)("span",{class:"token punctuation"},"]"),(0,a.Uk)("\n          "),(0,a._)("span",{class:"token punctuation"},"}"),(0,a.Uk)("\n        "),(0,a._)("span",{class:"token punctuation"},"]"),(0,a.Uk)("\n      "),(0,a._)("span",{class:"token punctuation"},"}"),(0,a._)("span",{class:"token punctuation"},","),(0,a.Uk)("\n      "),(0,a._)("span",{class:"token property"},'"streamSettings"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token punctuation"},"{"),(0,a.Uk)("\n        "),(0,a._)("span",{class:"token property"},'"network"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token string"},'"tcp"'),(0,a._)("span",{class:"token punctuation"},","),(0,a.Uk)("\n        "),(0,a._)("span",{class:"token property"},'"security"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token string"},'"tls"'),(0,a._)("span",{class:"token punctuation"},","),(0,a.Uk)("\n        "),(0,a._)("span",{class:"token property"},'"tlsSettings"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token punctuation"},"{"),(0,a.Uk)("\n          "),(0,a._)("span",{class:"token property"},'"serverName"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token string"},'"a-name.yourdomain.com"'),(0,a._)("span",{class:"token punctuation"},","),(0,a.Uk)("\n          "),(0,a._)("span",{class:"token property"},'"allowInsecure"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token boolean"},"false"),(0,a._)("span",{class:"token punctuation"},","),(0,a.Uk)("\n          "),(0,a._)("span",{class:"token property"},'"fingerprint"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token string"},'"chrome"'),(0,a.Uk)("\n        "),(0,a._)("span",{class:"token punctuation"},"}"),(0,a.Uk)("\n      "),(0,a._)("span",{class:"token punctuation"},"}"),(0,a.Uk)("\n    "),(0,a._)("span",{class:"token punctuation"},"}"),(0,a.Uk)("\n  "),(0,a._)("span",{class:"token punctuation"},"]"),(0,a.Uk)("\n"),(0,a._)("span",{class:"token punctuation"},"}"),(0,a.Uk)("\n")])]),(0,a._)("div",{class:"line-numbers"},[(0,a._)("span",{class:"line-number"},"1"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"2"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"3"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"4"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"5"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"6"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"7"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"8"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"9"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"10"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"11"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"12"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"13"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"14"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"15"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"16"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"17"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"18"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"19"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"20"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"21"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"22"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"23"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"24"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"25"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"26"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"27"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"28"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"29"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"30"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"31"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"32"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"33"),(0,a._)("br")])],-1),x=(0,a._)("h3",{id:"_2-3-路由",tabindex:"-1"},[(0,a._)("a",{class:"header-anchor",href:"#_2-3-路由","aria-hidden":"true"},"#"),(0,a.Uk)(" 2.3 路由")],-1),v=(0,a._)("div",{class:"custom-container tip"},[(0,a._)("p",{class:"custom-container-title"},"提示"),(0,a._)("p",null,[(0,a._)("strong",null,"路由："),(0,a.Uk)(" 就是把【入站】和【出站】之间的通道，用某种【条件】串联起来")])],-1),D=(0,a._)("p",null,[(0,a.Uk)("下面的路由配置示例，用大白话说就是：把所有通过 "),(0,a._)("code",null,'[tag]="inbound-10808"'),(0,a.Uk)(" 入站流入 "),(0,a._)("code",null,"Xray"),(0,a.Uk)(" 的流量，"),(0,a._)("code",null,"100%"),(0,a.Uk)(" 全部流转导入 "),(0,a._)("code",null,'[tag]="proxy-out-vless"'),(0,a.Uk)(" 的出站，没有任何分流或其他操作。")],-1),F=(0,a._)("div",{class:"language-json ext-json line-numbers-mode"},[(0,a._)("pre",{class:"language-json"},[(0,a._)("code",null,[(0,a._)("span",{class:"token punctuation"},"{"),(0,a.Uk)("\n  "),(0,a._)("span",{class:"token property"},'"routing"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token punctuation"},"{"),(0,a.Uk)("\n    "),(0,a._)("span",{class:"token property"},'"domainStrategy"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token string"},'"AsIs"'),(0,a._)("span",{class:"token punctuation"},","),(0,a.Uk)("\n    "),(0,a._)("span",{class:"token property"},'"rules"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token punctuation"},"["),(0,a.Uk)("\n      "),(0,a._)("span",{class:"token punctuation"},"{"),(0,a.Uk)("\n        "),(0,a._)("span",{class:"token property"},'"type"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token string"},'"field"'),(0,a._)("span",{class:"token punctuation"},","),(0,a.Uk)("\n        "),(0,a._)("span",{class:"token property"},'"inboundTag"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token punctuation"},"["),(0,a._)("span",{class:"token string"},'"inbound-10808"'),(0,a._)("span",{class:"token punctuation"},"]"),(0,a._)("span",{class:"token punctuation"},","),(0,a.Uk)("\n        "),(0,a._)("span",{class:"token property"},'"outboundTag"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token string"},'"proxy-out-vless"'),(0,a.Uk)("\n      "),(0,a._)("span",{class:"token punctuation"},"}"),(0,a.Uk)("\n    "),(0,a._)("span",{class:"token punctuation"},"]"),(0,a.Uk)("\n  "),(0,a._)("span",{class:"token punctuation"},"}"),(0,a.Uk)("\n"),(0,a._)("span",{class:"token punctuation"},"}"),(0,a.Uk)("\n")])]),(0,a._)("div",{class:"line-numbers"},[(0,a._)("span",{class:"line-number"},"1"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"2"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"3"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"4"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"5"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"6"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"7"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"8"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"9"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"10"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"11"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"12"),(0,a._)("br")])],-1),P=(0,a._)("p",null,[(0,a.Uk)("至此，我们最开始设计的极简规则【客户端的 "),(0,a._)("code",null,"Xray"),(0,a.Uk)(" 入站接收 APP 数据、在路由 100%转发给出站，并从出站流向 VPS】已经完成。")],-1),X=(0,a._)("h3",{id:"_2-4-路由配置项解析之一-流量筛选的依据",tabindex:"-1"},[(0,a._)("a",{class:"header-anchor",href:"#_2-4-路由配置项解析之一-流量筛选的依据","aria-hidden":"true"},"#"),(0,a.Uk)(" 2.4 路由配置项解析之一：流量筛选的依据")],-1),S=(0,a._)("p",null,"注意观察路由配置，我们可以看到几个新名词：",-1),R=(0,a._)("ol",null,[(0,a._)("li",null,[(0,a._)("code",null,'"domainStrategy": "AsIs"')]),(0,a._)("li",null,[(0,a._)("code",null,"“rules”")]),(0,a._)("li",null,[(0,a._)("code",null,'"type": "field"')]),(0,a._)("li",null,[(0,a._)("code",null,'"inboundTag": ["inbound-10808"]')]),(0,a._)("li",null,[(0,a._)("code",null,'"outboundTag": "proxy-out-vless"')])],-1),V=(0,a._)("p",null,[(0,a.Uk)("其中 "),(0,a._)("code",null,"domainStrategy"),(0,a.Uk)(" 我们暂且按下不表，先简单说明后面几个：")],-1),O=(0,a._)("table",null,[(0,a._)("thead",null,[(0,a._)("tr",null,[(0,a._)("th",{style:{"text-align":"center"}},"配置名称"),(0,a._)("th",{style:{"text-align":"center"}},"配置值"),(0,a._)("th",{style:{"text-align":"left"}},"配置说明")])]),(0,a._)("tbody",null,[(0,a._)("tr",null,[(0,a._)("td",{style:{"text-align":"center"}},[(0,a._)("code",null,"“rules”")]),(0,a._)("td",{style:{"text-align":"center"}},"                                                   "),(0,a._)("td",{style:{"text-align":"left"}},"它的内层就是【路由规则】的明细设置")]),(0,a._)("tr",null,[(0,a._)("td",{style:{"text-align":"center"}},[(0,a._)("code",null,'"type"')]),(0,a._)("td",{style:{"text-align":"center"}},[(0,a._)("code",null,'"field"')]),(0,a._)("td",{style:{"text-align":"left"}},"该项暂时没有特别定义，但是不能省略，所以记得写上就好")]),(0,a._)("tr",null,[(0,a._)("td",{style:{"text-align":"center"}},[(0,a._)("code",null,'"inboundTag"')]),(0,a._)("td",{style:{"text-align":"center"}},[(0,a._)("code",null,'["inbound-10808"]')]),(0,a._)("td",{style:{"text-align":"left"}},[(0,a.Uk)("筛选流量的 "),(0,a._)("strong",null,"【依据】"),(0,a.Uk)(" 是【入站 Tag】，具体 "),(0,a._)("strong",null,"【条件】"),(0,a.Uk)(" 现在只有一个：【入站来源是 "),(0,a._)("code",null,"inbound-10808"),(0,a.Uk)("】")])]),(0,a._)("tr",null,[(0,a._)("td",{style:{"text-align":"center"}},[(0,a._)("code",null,'"outboundTag"')]),(0,a._)("td",{style:{"text-align":"center"}},[(0,a._)("code",null,'"proxy-out-vless"')]),(0,a._)("td",{style:{"text-align":"left"}},[(0,a.Uk)("当上面的筛选条件成立时（即入站"),(0,a._)("code",null,'[tag]="inbound-10808"'),(0,a.Uk)("时 ），"),(0,a._)("code",null,"Xray"),(0,a.Uk)(" 会将流量导入 "),(0,a._)("code",null,'[tag]="proxy-out-vless"'),(0,a.Uk)(" 的出站")])])])],-1),C=(0,a._)("p",null,[(0,a.Uk)("本例中，我们只有一个入站，它的"),(0,a._)("code",null,'"inboundTag" = "inbound-10808"'),(0,a.Uk)(" 。我们也只有一个出站，它的 "),(0,a._)("code",null,'[tag]="proxy-out-vless"'),(0,a.Uk)("。所以根据上面这个路由规则，从唯一入站端口 "),(0,a._)("code",null,"10808"),(0,a.Uk)(" 流入"),(0,a._)("code",null,"Xray"),(0,a.Uk)("的流量，"),(0,a._)("code",null,"100%"),(0,a.Uk)(" 符合筛选条件、会被路由模块选中，然后转发给唯一的出站。")],-1),j=(0,a._)("p",null,[(0,a.Uk)("至此，"),(0,a._)("strong",null,"入站"),(0,a.Uk)("、"),(0,a._)("strong",null,"路由"),(0,a.Uk)("、"),(0,a._)("strong",null,"出站"),(0,a.Uk)(" 三兄弟就已经可以携手工作了。当然，现在这个 100%转发的工作并没有什么特别的意义。那么接下来，我们就看看这种分工合作的机制可以带来什么好处。")],-1),w=(0,a._)("h2",{id:"_3-小试牛刀-三分天下-之-域名分流",tabindex:"-1"},[(0,a._)("a",{class:"header-anchor",href:"#_3-小试牛刀-三分天下-之-域名分流","aria-hidden":"true"},"#"),(0,a.Uk)(" 3. 小试牛刀： “三分天下” 之 “域名分流”")],-1),L=(0,a._)("blockquote",null,[(0,a._)("p",null,[(0,a._)("code",null,"[geosite.dat]")])],-1),I=(0,a._)("p",null,"这个配置逻辑，其实就是最简单、最常用的（《小小白白话文》中也在用的）路由配置三件套：",-1),T=(0,a._)("ol",null,[(0,a._)("li",null,[(0,a.Uk)("广告流量屏蔽 "),(0,a._)("code",null,"[block]")]),(0,a._)("li",null,[(0,a.Uk)("国内流量直连 "),(0,a._)("code",null,"[direct]")]),(0,a._)("li",null,[(0,a.Uk)("国外流量转发 VPS "),(0,a._)("code",null,"[proxy]")])],-1),W=(0,a._)("div",{class:"custom-container warning"},[(0,a._)("p",{class:"custom-container-title"},"注意"),(0,a._)("p",null,"小小白白话文中的直连配置是包括【国内域名】、【国内 IP】、【本机内部 IP】的。这里先讲解【国内域名】。")],-1),q=(0,a._)("h3",{id:"_3-1-入站",tabindex:"-1"},[(0,a._)("a",{class:"header-anchor",href:"#_3-1-入站","aria-hidden":"true"},"#"),(0,a.Uk)(" 3.1 入站")],-1),G=(0,a._)("p",null,[(0,a.Uk)("保持上例的 "),(0,a._)("code",null,"inbound-10808"),(0,a.Uk)(" 不变。")],-1),H=(0,a._)("h3",{id:"_3-2-出站",tabindex:"-1"},[(0,a._)("a",{class:"header-anchor",href:"#_3-2-出站","aria-hidden":"true"},"#"),(0,a.Uk)(" 3.2 出站")],-1),J=(0,a._)("p",null,[(0,a.Uk)("在上例的基础上，我们已经有了 "),(0,a._)("code",null,"[proxy]"),(0,a.Uk)(" 的出站 "),(0,a._)("code",null,'"proxy-out-vless"'),(0,a.Uk)("，所以它保持不变。显而易见，我们需要加入两个新的出站方式："),(0,a._)("code",null,"[block]"),(0,a.Uk)(" 和 "),(0,a._)("code",null,"[direct]"),(0,a.Uk)("，如下：")],-1),N=(0,a._)("div",{class:"language-json ext-json line-numbers-mode"},[(0,a._)("pre",{class:"language-json"},[(0,a._)("code",null,[(0,a._)("span",{class:"token punctuation"},"{"),(0,a.Uk)("\n  "),(0,a._)("span",{class:"token property"},'"outbounds"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token punctuation"},"["),(0,a.Uk)("\n    "),(0,a._)("span",{class:"token punctuation"},"{"),(0,a.Uk)("\n      "),(0,a._)("span",{class:"token property"},'"tag"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token string"},'"proxy-out-vless"'),(0,a.Uk)("\n      "),(0,a._)("span",{class:"token comment"},"// ... ..."),(0,a.Uk)("\n    "),(0,a._)("span",{class:"token punctuation"},"}"),(0,a._)("span",{class:"token punctuation"},","),(0,a.Uk)("\n    "),(0,a._)("span",{class:"token punctuation"},"{"),(0,a.Uk)("\n      "),(0,a._)("span",{class:"token property"},'"tag"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token string"},'"block"'),(0,a._)("span",{class:"token punctuation"},","),(0,a.Uk)("\n      "),(0,a._)("span",{class:"token property"},'"protocol"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token string"},'"blackhole"'),(0,a.Uk)("\n    "),(0,a._)("span",{class:"token punctuation"},"}"),(0,a._)("span",{class:"token punctuation"},","),(0,a.Uk)("\n    "),(0,a._)("span",{class:"token punctuation"},"{"),(0,a.Uk)("\n      "),(0,a._)("span",{class:"token property"},'"tag"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token string"},'"direct-out"'),(0,a._)("span",{class:"token punctuation"},","),(0,a.Uk)("\n      "),(0,a._)("span",{class:"token property"},'"protocol"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token string"},'"freedom"'),(0,a.Uk)("\n    "),(0,a._)("span",{class:"token punctuation"},"}"),(0,a.Uk)("\n  "),(0,a._)("span",{class:"token punctuation"},"]"),(0,a.Uk)("\n"),(0,a._)("span",{class:"token punctuation"},"}"),(0,a.Uk)("\n")])]),(0,a._)("div",{class:"line-numbers"},[(0,a._)("span",{class:"line-number"},"1"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"2"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"3"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"4"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"5"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"6"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"7"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"8"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"9"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"10"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"11"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"12"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"13"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"14"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"15"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"16"),(0,a._)("br")])],-1),z=(0,a._)("p",null,"上面的配置用大白话翻译如下：",-1),M=(0,a._)("ol",null,[(0,a._)("li",null,[(0,a.Uk)("上例中的 "),(0,a._)("code",null,"[proxy-out-vless]"),(0,a.Uk)(" 出站配置保持不变")]),(0,a._)("li",null,[(0,a.Uk)("加入 "),(0,a._)("strong",null,[(0,a._)("code",null,"blackhole"),(0,a.Uk)(" 黑洞协议")]),(0,a.Uk)("，通过这个协议出站的流量，其实都被发送到了 "),(0,a._)("code",null,"Xray"),(0,a.Uk)(" 内部的黑洞里，再也无法逃脱，于是效果就是屏蔽 "),(0,a._)("code",null,"[block]")]),(0,a._)("li",null,[(0,a.Uk)("加入 "),(0,a._)("strong",null,[(0,a._)("code",null,"freedom"),(0,a.Uk)(" 自由协议")]),(0,a.Uk)("，通过这个协议出站的流量，是自由的离开"),(0,a._)("code",null,"Xray"),(0,a.Uk)("去寻找原定的服务器，就像从没有来过，于是效果就是直连 "),(0,a._)("code",null,"[direct]"),(0,a.Uk)(" （我这里起名叫做 "),(0,a._)("code",null,"[direct-out]"),(0,a.Uk)(" 是为了强调它是一个出站）")])],-1),Y=(0,a._)("h3",{id:"_3-3-路由",tabindex:"-1"},[(0,a._)("a",{class:"header-anchor",href:"#_3-3-路由","aria-hidden":"true"},"#"),(0,a.Uk)(" 3.3 路由")],-1),K=(0,a._)("p",null,"接下来就是见证奇迹的时刻了，我们可以用【路由】的配置把这些连接起来！",-1),Q=(0,a._)("div",{class:"language-json ext-json line-numbers-mode"},[(0,a._)("pre",{class:"language-json"},[(0,a._)("code",null,[(0,a._)("span",{class:"token punctuation"},"{"),(0,a.Uk)("\n  "),(0,a._)("span",{class:"token property"},'"routing"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token punctuation"},"{"),(0,a.Uk)("\n    "),(0,a._)("span",{class:"token property"},'"domainStrategy"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token string"},'"AsIs"'),(0,a._)("span",{class:"token punctuation"},","),(0,a.Uk)("\n    "),(0,a._)("span",{class:"token property"},'"rules"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token punctuation"},"["),(0,a.Uk)("\n      "),(0,a._)("span",{class:"token punctuation"},"{"),(0,a.Uk)("\n        "),(0,a._)("span",{class:"token property"},'"type"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token string"},'"field"'),(0,a._)("span",{class:"token punctuation"},","),(0,a.Uk)("\n        "),(0,a._)("span",{class:"token property"},'"domain"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token punctuation"},"["),(0,a._)("span",{class:"token string"},'"geosite:category-ads-all"'),(0,a._)("span",{class:"token punctuation"},"]"),(0,a._)("span",{class:"token punctuation"},","),(0,a.Uk)("\n        "),(0,a._)("span",{class:"token property"},'"outboundTag"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token string"},'"block"'),(0,a.Uk)("\n      "),(0,a._)("span",{class:"token punctuation"},"}"),(0,a._)("span",{class:"token punctuation"},","),(0,a.Uk)("\n      "),(0,a._)("span",{class:"token punctuation"},"{"),(0,a.Uk)("\n        "),(0,a._)("span",{class:"token property"},'"type"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token string"},'"field"'),(0,a._)("span",{class:"token punctuation"},","),(0,a.Uk)("\n        "),(0,a._)("span",{class:"token property"},'"domain"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token punctuation"},"["),(0,a._)("span",{class:"token string"},'"geosite:cn"'),(0,a._)("span",{class:"token punctuation"},"]"),(0,a._)("span",{class:"token punctuation"},","),(0,a.Uk)("\n        "),(0,a._)("span",{class:"token property"},'"outboundTag"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token string"},'"direct-out"'),(0,a.Uk)("\n      "),(0,a._)("span",{class:"token punctuation"},"}"),(0,a._)("span",{class:"token punctuation"},","),(0,a.Uk)("\n      "),(0,a._)("span",{class:"token punctuation"},"{"),(0,a.Uk)("\n        "),(0,a._)("span",{class:"token property"},'"type"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token string"},'"field"'),(0,a._)("span",{class:"token punctuation"},","),(0,a.Uk)("\n        "),(0,a._)("span",{class:"token property"},'"domain"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token punctuation"},"["),(0,a._)("span",{class:"token string"},'"geosite:geolocation-!cn"'),(0,a._)("span",{class:"token punctuation"},"]"),(0,a._)("span",{class:"token punctuation"},","),(0,a.Uk)("\n        "),(0,a._)("span",{class:"token property"},'"outboundTag"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token string"},'"proxy-out-vless"'),(0,a.Uk)("\n      "),(0,a._)("span",{class:"token punctuation"},"}"),(0,a.Uk)("\n    "),(0,a._)("span",{class:"token punctuation"},"]"),(0,a.Uk)("\n  "),(0,a._)("span",{class:"token punctuation"},"}"),(0,a.Uk)("\n"),(0,a._)("span",{class:"token punctuation"},"}"),(0,a.Uk)("\n")])]),(0,a._)("div",{class:"line-numbers"},[(0,a._)("span",{class:"line-number"},"1"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"2"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"3"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"4"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"5"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"6"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"7"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"8"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"9"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"10"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"11"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"12"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"13"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"14"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"15"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"16"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"17"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"18"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"19"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"20"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"21"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"22"),(0,a._)("br")])],-1),Z=(0,a._)("p",null,"为了理解这个配置文件，我们要稍微解释一下这里出现的几个新配置项：",-1),$=(0,a._)("ul",null,[(0,a._)("li",null,[(0,a._)("code",null,'"domain": ["geosite:category-ads-all"]')]),(0,a._)("li",null,[(0,a._)("code",null,'"domain": ["geosite:cn"]')]),(0,a._)("li",null,[(0,a._)("code",null,'"domain": ["geosite:geolocation-!cn"]')])],-1),nn=(0,a._)("h3",{id:"_3-4-简析域名文件-geosite-dat",tabindex:"-1"},[(0,a._)("a",{class:"header-anchor",href:"#_3-4-简析域名文件-geosite-dat","aria-hidden":"true"},"#"),(0,a.Uk)(" 3.4 简析域名文件： "),(0,a._)("code",null,"geosite.dat")],-1),sn=(0,a._)("p",null,"其实，聪明的你大概可以通过这些配置项的名称猜出来个大概：",-1),ln=(0,a._)("ul",null,[(0,a._)("li",null,[(0,a._)("code",null,'"domain"'),(0,a.Uk)("：就是这次筛选流量的 "),(0,a._)("strong",null,"【依据】"),(0,a.Uk)(" 是 "),(0,a._)("strong",null,"【域名】"),(0,a.Uk)(" （而不再是入站 tag）")]),(0,a._)("li",null,[(0,a._)("code",null,'"geosite"'),(0,a.Uk)("：就是 "),(0,a._)("code",null,"Xray"),(0,a.Uk)(" 会去 "),(0,a._)("code",null,"geosite.dat"),(0,a.Uk)(" 文件中寻找 "),(0,a._)("strong",null,"【符合条件的域名】")]),(0,a._)("li",null,[(0,a._)("code",null,'"category-ads-all"'),(0,a.Uk)("：就是该文件中的 "),(0,a._)("strong",null,"【所有广告类域名】")]),(0,a._)("li",null,[(0,a._)("code",null,'"cn"'),(0,a.Uk)("：就是该文件中的 "),(0,a._)("strong",null,"【中国域名】")]),(0,a._)("li",null,[(0,a._)("code",null,'"geolocation-!cn"'),(0,a.Uk)("：就是该文件中的 "),(0,a._)("strong",null,"【非中国域名】")])],-1),an=(0,a._)("p",null,"结合这些说明，3.3 中的配置用大白话翻译就是：",-1),en=(0,a._)("ol",null,[(0,a._)("li",null,[(0,a.Uk)("APP 试图访问国外域名 "),(0,a._)("code",null,'"domain": "geolocation-!cn"'),(0,a.Uk)(" 的流量，通过 "),(0,a._)("code",null,"[proxy-out-vless]"),(0,a.Uk)(" 出站，转发至 VPS")]),(0,a._)("li",null,[(0,a.Uk)("APP 试图访问国外域名广告域名 "),(0,a._)("code",null,'"domain": "geosite:category-ads-all"'),(0,a.Uk)(" 的流量，通过 "),(0,a._)("code",null,"[block]"),(0,a.Uk)(" 出站，转发至黑洞进行屏蔽")]),(0,a._)("li",null,[(0,a.Uk)("APP 试图访问国内域名 "),(0,a._)("code",null,'"domain": "geosite:cn"'),(0,a.Uk)(" 的流量，通过 "),(0,a._)("code",null,"[direct-out]"),(0,a.Uk)(" 出站，自由离开完成直连")])],-1),tn=(0,a._)("p",null,"这时，才让【路由功能】的好处稍微得到了一些展现。",-1),on=(0,a._)("h3",{id:"_3-5-所以-geosite-dat-到底是什么-不是有个-gfwlist-吗",tabindex:"-1"},[(0,a._)("a",{class:"header-anchor",href:"#_3-5-所以-geosite-dat-到底是什么-不是有个-gfwlist-吗","aria-hidden":"true"},"#"),(0,a.Uk)(" 3.5 所以 "),(0,a._)("code",null,"geosite.dat"),(0,a.Uk)(" 到底是什么？不是有个 "),(0,a._)("code",null,"GFWList"),(0,a.Uk)(" 吗？")],-1),rn=(0,a._)("p",null,"你想，这世界上的域名何止千万，如果我们每写一个基于【域名】匹配的路由规则，都要自己收集、手动输入域名，那效率将会何其低下！",-1),_n=(0,a._)("p",null,[(0,a.Uk)("而如果所有的域名都只有一个种类，"),(0,a._)("code",null,"[direct], [proxy], [block]"),(0,a.Uk)(" 只能三选其一，那又是多么的不方便！")],-1),cn=(0,a._)("p",null,[(0,a.Uk)("就如关羽需要他的青龙偃月刀，"),(0,a._)("code",null,"geosite.dat"),(0,a.Uk)(" 文件便作为【路由功能】驱使的神兵利器横空出世了，它致力于为用户提供成熟完善的【域名分类表】。让用户可以简单的通过 "),(0,a._)("code",null,"geosite:xxx"),(0,a.Uk)(" 这种格式方便的调用任何子类，定制符合自身需求的路由规则。")],-1),pn=(0,a.Uk)("这种模块化结构提供的灵活性，其实远超传统的一揽子防火墙域名列表 "),un={href:"https://github.com/gfwlist/gfwlist",target:"_blank",rel:"noopener noreferrer"},kn=(0,a._)("code",null,"GFWList",-1),dn=(0,a.Uk)("。为什么这么说呢？比如，你可以指定苹果的域名 "),Un=(0,a._)("code",null,"geosite:apple",-1),bn=(0,a.Uk)(" 和 icloud 相关域名 "),gn=(0,a._)("code",null,"geosite:icloud",-1),mn=(0,a.Uk)(" 通过代理 "),yn=(0,a._)("code",null,"[proxy]",-1),An=(0,a.Uk)("，但是苹果的软件域名 "),hn=(0,a._)("code",null,"geosite:apple-update",-1),En=(0,a.Uk)(" 保持直连 "),fn=(0,a._)("code",null,"[direct]",-1),Bn=(0,a.Uk)(" 来保持最大下载速度。"),xn={class:"custom-container warning"},vn=(0,a._)("p",{class:"custom-container-title"},"注意",-1),Dn=(0,a._)("p",null,[(0,a._)("strong",null,"注意："),(0,a.Uk)(" 现在，"),(0,a._)("code",null,"geosite.dat"),(0,a.Uk)(" 文件其实有多种选择：")],-1),Fn=(0,a.Uk)("最初，从 "),Pn=(0,a._)("code",null,"Victoria Raymond",-1),Xn=(0,a.Uk)(" 主力维护 "),Sn=(0,a._)("code",null,"Project V",-1),Rn=(0,a.Uk)(" 项目时期，便提供了最初的配套项目："),Vn={href:"https://github.com/v2ray/domain-list-community",target:"_blank",rel:"noopener noreferrer"},On=(0,a._)("code",null,"domain-list-community",-1),Cn=(0,a.Uk)("，用来收集、沉淀、分类各种常用的域名类型；"),jn=(0,a.Uk)("之后，随着 V 姐突然消失导致 "),wn=(0,a._)("code",null,"Project V",-1),Ln=(0,a.Uk)(" 的原项目开发陷入停滞，"),In=(0,a._)("code",null,"v2fly",-1),Tn=(0,a.Uk)(" 社区维护并持续更新了社区版本的 "),Wn={href:"https://github.com/v2fly/domain-list-community",target:"_blank",rel:"noopener noreferrer"},qn=(0,a._)("code",null,"domain-list-community",-1),Gn=(0,a.Uk)("；"),Hn=(0,a.Uk)("同时，"),Jn=(0,a._)("a",{href:"Loyalsoldier"},"@Loyalsoldier",-1),Nn=(0,a.Uk)(" 维护了其个人修改增强的路由规则文件 "),zn={href:"https://github.com/Loyalsoldier/v2ray-rules-dat",target:"_blank",rel:"noopener noreferrer"},Mn=(0,a.Uk)("v2ray-rules-dat"),Yn=(0,a.Uk)("，提供了诸多不同的选择和分类逻辑；"),Kn=(0,a.Uk)("另外，"),Qn=(0,a._)("code",null,"Project X",-1),Zn=(0,a.Uk)(" 也计划于未来定制维护更适合 "),$n=(0,a._)("code",null,"Xray",-1),ns=(0,a.Uk)(" 使用的路由规则文件 "),ss={href:"https://github.com/XTLS/Xray-rules-dat",target:"_blank",rel:"noopener noreferrer"},ls=(0,a.Uk)("Xray-rules-dat"),as=(0,a.Uk)("。"),es=(0,a._)("s",null,"(你们看，文件夹都建好了，所以快了快了)",-1),ts=(0,a._)("p",null,[(0,a.Uk)("甚至，你还可以定制自己的 "),(0,a._)("code",null,"geosite"),(0,a.Uk)(" 文件，外挂给 "),(0,a._)("code",null,"Xray"),(0,a.Uk)(" 使用，但是这个就跑题了，本文不展开。")],-1),os=(0,a._)("p",null,[(0,a.Uk)("如果你发现有些你遇到的域名没有被合理分类，请向上面的项目们提出 "),(0,a._)("code",null,"issue"),(0,a.Uk)(" 甚至提交 "),(0,a._)("code",null,"Pull Request"),(0,a.Uk)(" 吧！社区列表社区维护，人人为我我为人人！")],-1),rs=(0,a._)("h3",{id:"_3-6-军师锦囊藏奇兵-一条隐藏的路由规则",tabindex:"-1"},[(0,a._)("a",{class:"header-anchor",href:"#_3-6-军师锦囊藏奇兵-一条隐藏的路由规则","aria-hidden":"true"},"#"),(0,a.Uk)(" 3.6 军师锦囊藏奇兵：一条隐藏的路由规则")],-1),_s=(0,a._)("p",null,[(0,a.Uk)("事实上，当你认真思考上面的规则，不难发现一个问题，我们的所有规则都只规定了【当入站流量 "),(0,a._)("strong",null,"符合某种条件时"),(0,a.Uk)(" 应该被转发给哪个出站】，那么，如果 "),(0,a._)("code",null,"geosite.dat"),(0,a.Uk)(" 文件不全面，我们的入站流量【"),(0,a._)("strong",null,"不符合任何条件时"),(0,a.Uk)("】，"),(0,a._)("code",null,"Xray"),(0,a.Uk)(" 会怎么处理呢？")],-1),cs=(0,a._)("div",{class:"custom-container warning"},[(0,a._)("p",{class:"custom-container-title"},"注意"),(0,a._)("p",null,[(0,a.Uk)("如果你认为【不符合条件当然就无法连接啦！】的话，你可要重新思考一下哦。因为只有指定了 "),(0,a._)("code",null,"[block]"),(0,a.Uk)(" 规则，才会被导入到 "),(0,a._)("code",null,"blackhole"),(0,a.Uk)(" 黑洞协议从而阻断连接")])],-1),ps=(0,a._)("p",null,[(0,a.Uk)("事实上，"),(0,a._)("code",null,"Xray"),(0,a.Uk)(" 为了避免路由规则不完全导致的规则混乱，已经贴心的提供了一条隐藏的路由规则：【"),(0,a._)("strong",null,"当入站流量不符合任何条件时，转发给第一个出站"),(0,a.Uk)(" 】")],-1),us=(0,a._)("p",null,"这样，就不会有任何流量被漏掉了。所以，你一定要把你最信赖的心腹大将放在【第一条出站】，让它为你守城护池。",-1),is=(0,a._)("h3",{id:"_3-7-再看-三分天下-的大地图",tabindex:"-1"},[(0,a._)("a",{class:"header-anchor",href:"#_3-7-再看-三分天下-的大地图","aria-hidden":"true"},"#"),(0,a.Uk)(" 3.7 再看“三分天下”的大地图")],-1),ks=(0,a._)("p",null,[(0,a.Uk)("因为我们在前面的示例中把 "),(0,a._)("code",null,"[proxy-out-vless]"),(0,a.Uk)(" 放在了出站的第一位，所以隐藏规则生效时，流量会通过 "),(0,a._)("code",null,"VLESS"),(0,a.Uk)(" 协议被转发至远端的 VPS。因此，"),(0,a._)("code",null,"Xray"),(0,a.Uk)(" 此时的完整工作逻辑如下：")],-1),ds=(0,a._)("p",null,[(0,a.Uk)("事实上，这就是传统所谓的 "),(0,a._)("strong",null,"【默认科学上网、国内网站白名单直连】"),(0,a.Uk)(" 的配置。")],-1),Us=(0,a._)("h2",{id:"_4-三分天下-之-蜀魏争雄",tabindex:"-1"},[(0,a._)("a",{class:"header-anchor",href:"#_4-三分天下-之-蜀魏争雄","aria-hidden":"true"},"#"),(0,a.Uk)(" 4. “三分天下” 之 “蜀魏争雄”")],-1),bs=(0,a._)("p",null,[(0,a.Uk)("现在，你已经知道了隐藏的默认路由规则：【"),(0,a._)("strong",null,"当入站流量不符合任何条件时，转发给第一个出站"),(0,a.Uk)(" 】。这时候，你应该能看出来，究竟是【科学上网】为王，还是【直连】称霸，全看你的第一条出站是什么！")],-1),gs=(0,a._)("p",null,[(0,a.Uk)("上一步我们已经配置出了 "),(0,a._)("strong",null,"【默认科学上网、国内网站白名单直连】"),(0,a.Uk)(" 的规则。那么现在只要 "),(0,a._)("strong",null,"【把直连规则放在第一位】"),(0,a.Uk)("，就立即变成了正好相反的 "),(0,a._)("strong",null,"【默认直连、国外网站白名单科学上网】"),(0,a.Uk)(" 规则。")],-1),ms=(0,a._)("p",null,"是不是，非常地简单？",-1),ys=(0,a._)("div",{class:"language-json ext-json line-numbers-mode"},[(0,a._)("pre",{class:"language-json"},[(0,a._)("code",null,[(0,a._)("span",{class:"token punctuation"},"{"),(0,a.Uk)("\n  "),(0,a._)("span",{class:"token property"},'"outbounds"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token punctuation"},"["),(0,a.Uk)("\n    "),(0,a._)("span",{class:"token punctuation"},"{"),(0,a.Uk)("\n      "),(0,a._)("span",{class:"token property"},'"tag"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token string"},'"direct-out"'),(0,a._)("span",{class:"token punctuation"},","),(0,a.Uk)("\n      "),(0,a._)("span",{class:"token property"},'"protocol"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token string"},'"freedom"'),(0,a.Uk)("\n    "),(0,a._)("span",{class:"token punctuation"},"}"),(0,a._)("span",{class:"token punctuation"},","),(0,a.Uk)("\n    "),(0,a._)("span",{class:"token punctuation"},"{"),(0,a.Uk)("\n      "),(0,a._)("span",{class:"token property"},'"tag"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token string"},'"proxy-out-vless"'),(0,a.Uk)("\n      "),(0,a._)("span",{class:"token comment"},"// ... ..."),(0,a.Uk)("\n    "),(0,a._)("span",{class:"token punctuation"},"}"),(0,a._)("span",{class:"token punctuation"},","),(0,a.Uk)("\n    "),(0,a._)("span",{class:"token punctuation"},"{"),(0,a.Uk)("\n      "),(0,a._)("span",{class:"token property"},'"tag"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token string"},'"block"'),(0,a._)("span",{class:"token punctuation"},","),(0,a.Uk)("\n      "),(0,a._)("span",{class:"token property"},'"protocol"'),(0,a._)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a._)("span",{class:"token string"},'"blackhole"'),(0,a.Uk)("\n    "),(0,a._)("span",{class:"token punctuation"},"}"),(0,a.Uk)("\n  "),(0,a._)("span",{class:"token punctuation"},"]"),(0,a.Uk)("\n"),(0,a._)("span",{class:"token punctuation"},"}"),(0,a.Uk)("\n")])]),(0,a._)("div",{class:"line-numbers"},[(0,a._)("span",{class:"line-number"},"1"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"2"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"3"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"4"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"5"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"6"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"7"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"8"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"9"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"10"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"11"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"12"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"13"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"14"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"15"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"16"),(0,a._)("br")])],-1),As=(0,a._)("p",null,"此时，路由规则其实变成了：",-1),hs=(0,a._)("p",null,"这就是路由功能的灵活之处了，你可以自由的改变它的顺序来实现不同的设计。",-1),Es=(0,a._)("p",null,[(0,a.Uk)("至此，我们已经解释完了 "),(0,a._)("strong",null,[(0,a.Uk)("【如何利用 "),(0,a._)("code",null,"geosite.dat"),(0,a.Uk)(" 文件，通过路由规则，根据【域名】来分流网络流量】。")])],-1),fs=(0,a._)("h2",{id:"_5-攻城略池-多种路由匹配条件",tabindex:"-1"},[(0,a._)("a",{class:"header-anchor",href:"#_5-攻城略池-多种路由匹配条件","aria-hidden":"true"},"#"),(0,a.Uk)(" 5. 攻城略池 - 多种路由匹配条件")],-1),Bs=(0,a._)("p",null,"请确保你已经读懂了上面的内容，因为这样，你就已经理解了【路由】功能的工作逻辑。有了这个基础，我们就可以继续分析【路由】功能更多更详细的配置方式和匹配条件了。",-1),xs=(0,a.Uk)("等你看完后面的内容，就完全可以自由的定制属于自己的路由规则啦！还等什么，让我们一起进入 "),vs=(0,a.Uk)("《路由 (routing) 功能简析（下）》"),Ds=(0,a.Uk)(" 吧！"),Fs={render:function(n,s){const l=(0,a.up)("Mermaid"),e=(0,a.up)("OutboundLink"),Fs=(0,a.up)("RouterLink");return(0,a.wg)(),(0,a.iD)(a.HY,null,[t,o,r,_,c,p,u,i,k,d,U,(0,a.Wm)(l,{identifier:"mermaid_382ee188",graph:"%20%20%20%20graph%20LR;%0A%0A%20%20%20%20S(APP%E6%95%B0%E6%8D%AE)%20.-%3E%20I%5B%E5%85%A5%E7%AB%99%5D%0A%0A%20%20%20%20subgraph%20Xray%0A%20%20%20%20I%20--%3E%20R%5B%E8%B7%AF%E7%94%B1%5D%20--%3E%20O%5B%E5%87%BA%E7%AB%99%5D%0A%20%20%20%20end%0A%0A%20%20%20%20O%20.-%3E%20V(VPS)%0A%0A%20%20%20%20V:::greyclass%0A%20%20%20%20S:::greyclass%0A%20%20%20%20R:::routingclass%0A%20%20%20%20classDef%20greyclass%20fill:#C0C0C0%0A%20%20%20%20classDef%20routingclass%20fill:#FFFFDE%0A%0A"}),b,g,m,y,A,h,E,f,B,x,v,D,F,P,X,S,R,V,O,C,j,w,L,(0,a.Wm)(l,{identifier:"mermaid_64a56ee8",graph:"%20%20%20%20graph%20LR;%0A%0A%20%20%20%20S(APP%E6%95%B0%E6%8D%AE)%20.-%3E%20I%5B%E5%85%A5%E7%AB%99%5D%0A%0A%20%20%20%20subgraph%20Xray%0A%20%20%20%20I%20--%3E%20R%5B%E8%B7%AF%E7%94%B1%5D%20--%20%22geosite:category-ads-all%22%20--%3E%20O1%5Bblock%5D%0A%20%20%20%20R%5B%E8%B7%AF%E7%94%B1%5D%20--%20%22geosite:cn%22%20--%3E%20O2%5Bdirect%5D%0A%20%20%20%20R%5B%E8%B7%AF%E7%94%B1%5D%20--%20%22geosite:geolocation-!cn%22%20--%3E%20O3%5Bproxy%5D%0A%0A%20%20%20%20end%0A%0A%20%20%20%20O2%20.-%3E%20D(%E5%9B%BD%E5%86%85%E6%9C%8D%E5%8A%A1%E5%99%A8)%0A%20%20%20%20O3%20.-%3E%20V(VPS)%0A%0A%20%20%20%20O1:::redclass%0A%20%20%20%20V:::greyclass%0A%20%20%20%20S:::greyclass%0A%20%20%20%20R:::routingclass%0A%0A%20%20%20%20classDef%20redclass%20fill:#FF0000%0A%20%20%20%20classDef%20greyclass%20fill:#C0C0C0%0A%20%20%20%20classDef%20routingclass%20fill:#FFFFDE,stroke:#000000%0A%0A"}),I,T,W,q,G,H,J,N,z,M,Y,K,Q,Z,$,nn,sn,ln,an,en,tn,on,rn,_n,cn,(0,a._)("p",null,[pn,(0,a._)("a",un,[kn,(0,a.Wm)(e)]),dn,Un,bn,gn,mn,yn,An,hn,En,fn,Bn]),(0,a._)("div",xn,[vn,Dn,(0,a._)("p",null,[Fn,Pn,Xn,Sn,Rn,(0,a._)("a",Vn,[On,(0,a.Wm)(e)]),Cn]),(0,a._)("p",null,[jn,wn,Ln,In,Tn,(0,a._)("a",Wn,[qn,(0,a.Wm)(e)]),Gn]),(0,a._)("p",null,[Hn,Jn,Nn,(0,a._)("a",zn,[Mn,(0,a.Wm)(e)]),Yn]),(0,a._)("p",null,[Kn,Qn,Zn,$n,ns,(0,a._)("a",ss,[ls,(0,a.Wm)(e)]),as,es]),ts,os]),rs,_s,cs,ps,us,is,ks,(0,a.Wm)(l,{identifier:"mermaid_64a55fb4",graph:"%20%20%20%20graph%20LR;%0A%0A%20%20%20%20S(APP%E6%95%B0%E6%8D%AE)%20.-%3E%20I%5B%E5%85%A5%E7%AB%99%5D%0A%0A%20%20%20%20subgraph%20Xray%0A%20%20%20%20I%20--%3E%20R%5B%E8%B7%AF%E7%94%B1%5D%20--%20%22geosite:category-ads-all%22%20--%3E%20O1%5Bblock%5D%0A%20%20%20%20R%5B%E8%B7%AF%E7%94%B1%5D%20--%20%22geosite:cn%22%20--%3E%20O2%5Bdirect%5D%0A%20%20%20%20R%5B%E8%B7%AF%E7%94%B1%5D%20--%20%22geosite:geolocation-!cn%22%20--%3E%20O3%5Bproxy%5D%0A%20%20%20%20R%5B%E8%B7%AF%E7%94%B1%5D%20-.%20%22%E6%B2%A1%E6%9C%89%E5%91%BD%E4%B8%AD%E8%A7%84%E5%88%99%E7%9A%84%E6%B5%81%E9%87%8F%22%20.-%3E%20O4%5B%E7%AC%AC%E4%B8%80%E6%9D%A1%E5%87%BA%E7%AB%99%5D%0A%0A%20%20%20%20end%0A%0A%20%20%20%20O2%20.-%3E%20D(%E5%9B%BD%E5%86%85%E6%9C%8D%E5%8A%A1%E5%99%A8)%0A%20%20%20%20O3%20.-%3E%20V(VPS)%0A%20%20%20%20O4%20.-%3E%20V(VPS)%0A%0A%20%20%20%20O1:::redclass%0A%20%20%20%20V:::greyclass%0A%20%20%20%20S:::greyclass%0A%20%20%20%20R:::routingclass%0A%0A%20%20%20%20classDef%20redclass%20fill:#FF0000%0A%20%20%20%20classDef%20greyclass%20fill:#C0C0C0%0A%20%20%20%20classDef%20routingclass%20fill:#FFFFDE,stroke:#000000%0A%0A"}),ds,Us,bs,gs,ms,ys,As,(0,a.Wm)(l,{identifier:"mermaid_64a55a22",graph:"%20%20%20%20graph%20LR;%0A%0A%20%20%20%20S(APP%E6%95%B0%E6%8D%AE)%20.-%3E%20I%5B%E5%85%A5%E7%AB%99%5D%0A%0A%20%20%20%20subgraph%20Xray%0A%20%20%20%20I%20--%3E%20R%5B%E8%B7%AF%E7%94%B1%5D%20--%20%22geosite:category-ads-all%22%20--%3E%20O1%5Bblock%5D%0A%20%20%20%20R%5B%E8%B7%AF%E7%94%B1%5D%20--%20%22geosite:geolocation-!cn%22%20--%3E%20O3%5Bproxy%5D%0A%20%20%20%20R%5B%E8%B7%AF%E7%94%B1%5D%20--%20%22geosite:cn%22%20--%3E%20O2%5Bdirect%5D%0A%20%20%20%20R%5B%E8%B7%AF%E7%94%B1%5D%20-.%20%22%E6%B2%A1%E6%9C%89%E5%91%BD%E4%B8%AD%E8%A7%84%E5%88%99%E7%9A%84%E6%B5%81%E9%87%8F%22%20.-%3E%20O4%5B%E7%AC%AC%E4%B8%80%E6%9D%A1%E5%87%BA%E7%AB%99%5D%0A%0A%20%20%20%20end%0A%0A%20%20%20%20O2%20.-%3E%20D(%E5%9B%BD%E5%86%85%E6%9C%8D%E5%8A%A1%E5%99%A8)%0A%20%20%20%20O3%20.-%3E%20V(VPS)%0A%20%20%20%20O4%20.-%3E%20D%0A%0A%20%20%20%20O1:::redclass%0A%20%20%20%20V:::greyclass%0A%20%20%20%20S:::greyclass%0A%20%20%20%20R:::routingclass%0A%20%20%20%20classDef%20redclass%20fill:#FF0000%0A%20%20%20%20classDef%20greyclass%20fill:#C0C0C0%0A%20%20%20%20classDef%20routingclass%20fill:#FFFFDE,stroke:#000000%0A%0A"}),hs,Es,fs,Bs,(0,a._)("p",null,[xs,(0,a.Wm)(Fs,{to:"/document/level-1/routing-lv1-part2.html"},{default:(0,a.w5)((()=>[vs])),_:1}),Ds])],64)}}},7832:(n,s,l)=>{n.exports=l.p+"assets/img/routing-lv1-img01-trio.34e9e930.png"}}]);