"use strict";(self.webpackChunkXray_docs_next=self.webpackChunkXray_docs_next||[]).push([[4732],{12612:(n,s,e)=>{e.r(s),e.d(s,{data:()=>a});const a={key:"v-4492d567",path:"/en/config/policy.html",title:"Local Policy",lang:"en-US",frontmatter:{},excerpt:"",headers:[{level:2,title:"PolicyObject",slug:"policyobject",children:[{level:3,title:"LevelPolicyObject",slug:"levelpolicyobject",children:[]},{level:3,title:"SystemPolicyObject",slug:"systempolicyobject",children:[]}]}],filePathRelative:"en/config/policy.md",git:{updatedTime:1678585494e3,contributors:[{name:"Winston2084",email:"126307318+Winston2084@users.noreply.github.com",commits:1},{name:"hmol233",email:"82594500+hmol233@users.noreply.github.com",commits:1}]}}},45002:(n,s,e)=>{e.r(s),e.d(s,{default:()=>o});const a=(0,e(66252).uE)('<h1 id="local-policy" tabindex="-1"><a class="header-anchor" href="#local-policy" aria-hidden="true">#</a> Local Policy</h1><p>Local policy can be used to set different policy settings for different user levels, such as connection timeout settings. Each connection handled by Xray corresponds to a user, and different policies are applied based on the user&#39;s level.</p><h2 id="policyobject" tabindex="-1"><a class="header-anchor" href="#policyobject" aria-hidden="true">#</a> PolicyObject</h2><p><code>PolicyObject</code> corresponds to the <code>policy</code> field in the configuration file.</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>\n  <span class="token property">&quot;policy&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token property">&quot;levels&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">&quot;0&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n        <span class="token property">&quot;handshake&quot;</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>\n        <span class="token property">&quot;connIdle&quot;</span><span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">,</span>\n        <span class="token property">&quot;uplinkOnly&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>\n        <span class="token property">&quot;downlinkOnly&quot;</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>\n        <span class="token property">&quot;statsUserUplink&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n        <span class="token property">&quot;statsUserDownlink&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n        <span class="token property">&quot;bufferSize&quot;</span><span class="token operator">:</span> <span class="token number">4</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token property">&quot;system&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">&quot;statsInboundUplink&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n      <span class="token property">&quot;statsInboundDownlink&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n      <span class="token property">&quot;statsOutboundUplink&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n      <span class="token property">&quot;statsOutboundDownlink&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><blockquote><p><code>level</code>: map{string: <a href="#levelpolicyobject">LevelPolicyObject</a>}</p></blockquote><p>A set of key-value pairs, where each key is a string representation of a number (as required by JSON), such as <code>&quot;0&quot;</code>, <code>&quot;1&quot;</code>, etc., with the number corresponding to the user level. Each value is a <a href="#levelpolicyobject">LevelPolicyObject</a>.</p><div class="custom-container tip"><p class="custom-container-title">Tip</p><p>Each inbound and outbound proxy can now set the user level, and Xray will apply different local policies based on the actual user level.</p></div><blockquote><p><code>system</code>: <a href="#systempolicyobject">SystemPolicyObject</a></p></blockquote><p>Xray system-level policy.</p><h3 id="levelpolicyobject" tabindex="-1"><a class="header-anchor" href="#levelpolicyobject" aria-hidden="true">#</a> LevelPolicyObject</h3><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>\n  <span class="token property">&quot;handshake&quot;</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;connIdle&quot;</span><span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;uplinkOnly&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;downlinkOnly&quot;</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;statsUserUplink&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;statsUserDownlink&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;bufferSize&quot;</span><span class="token operator">:</span> <span class="token number">10240</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><blockquote><p><code>handshake</code>: number</p></blockquote><p>The time limit for handshake during connection establishment. Unit: seconds. Default: <code>4</code>. When processing a new inbound connection, if the time used in the handshake phase exceeds this limit, the connection will be aborted.</p><blockquote><p><code>connIdle</code>: number</p></blockquote><p>The time limit for connection idle time. Unit: seconds. Default: <code>300</code>. When processing an inbound/outbound connection, if no data is transferred (including upstream and downstream data) within <code>connIdle</code> time, the connection will be aborted.</p><blockquote><p><code>uplinkOnly</code>: number</p></blockquote><p>The time limit after the downstream connection is closed. Unit: seconds. Default: <code>2</code>. When the server (such as a remote website) closes the downstream connection, the outbound proxy will abort the connection after waiting for <code>uplinkOnly</code> time.</p><blockquote><p><code>downlinkOnly</code>: number</p></blockquote><p>The time limit after the upstream connection is closed. Unit: seconds. Default: <code>5</code>. When the client (such as a browser) closes the upstream connection, the inbound proxy will abort the connection after waiting for <code>downlinkOnly</code> time.</p><div class="custom-container tip"><p class="custom-container-title">Tip</p><p>In the scenario of HTTP browsing, you can set <code>uplinkOnly</code> and <code>downlinkOnly</code> to <code>0</code> to improve the efficiency of connection closing.</p></div><blockquote><p><code>statsUserUplink</code>: true | false</p></blockquote><p>When set to <code>true</code>, enables upstream traffic statistics for all users at the current level.</p><blockquote><p><code>statsUserDownlink</code>: true | false</p></blockquote><p>When set to <code>true</code>, enables downstream traffic statistics for all users at the current level.</p><blockquote><p><code>bufferSize</code>: number</p></blockquote><p>The internal buffer size of each connection. Unit: kB. When set to <code>0</code>, the internal buffer is disabled.</p><p>Default values:</p><ul><li>On ARM, MIPS, and MIPSLE platforms, the default value is <code>0</code>.</li><li>On ARM64, MIPS64, and MIPS64LE platforms, the default value is <code>4</code>.</li><li>On other platforms, the default value is <code>512</code>.</li></ul><h3 id="systempolicyobject" tabindex="-1"><a class="header-anchor" href="#systempolicyobject" aria-hidden="true">#</a> SystemPolicyObject</h3><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>\n  <span class="token property">&quot;statsInboundUplink&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;statsInboundDownlink&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;statsOutboundUplink&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;statsOutboundDownlink&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p><code>statsInboundUplink</code>: true | false</p></blockquote><p>When set to <code>true</code>, enables upstream traffic statistics for all inbound proxies.</p><blockquote><p><code>statsInboundDownlink</code>: true | false</p></blockquote><p>When set to <code>true</code>, enables downstream traffic statistics for all inbound proxies.</p><blockquote><p><code>statsOutboundUplink</code>: true | false</p></blockquote><p>When set to <code>true</code>, enables upstream traffic statistics for all outbound proxies.</p><blockquote><p><code>statsOutboundDownlink</code>: true | false</p></blockquote><p>When set to <code>true</code>, enables downstream traffic statistics for all outbound proxies.</p>',39),o={render:function(n,s){return a}}}}]);