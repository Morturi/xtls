<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.25">
    <link rel="icon" href="/logo.png"><title>Routing | Project X</title><meta name="description" content="Official document of Xray">
    <link rel="preload" href="/assets/js/runtime~app.348769b8.js" as="script"><link rel="preload" href="/assets/css/styles.f4ef6178.css" as="style"><link rel="preload" href="/assets/js/3469.6a78c325.js" as="script"><link rel="preload" href="/assets/js/app.8c77f577.js" as="script">
    <link rel="stylesheet" href="/assets/css/styles.f4ef6178.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/en/" class=""><!----><span class="site-name">Project X</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="/en" class="nav-link router-link-active" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/en/about/news.md" class="nav-link" aria-label="大史记"><!--[--><!--]--> 大史记 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/en/config/" class="nav-link router-link-active" aria-label="配置指南"><!--[--><!--]--> 配置指南 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/en/development/" class="nav-link" aria-label="开发指南"><!--[--><!--]--> 开发指南 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/en/document/" class="nav-link" aria-label="使用指南"><!--[--><!--]--> 使用指南 <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/config/routing.html" class="nav-link" aria-label="简体中文"><!--[--><!--]--> 简体中文 <!--[--><!--]--></a></li><li class="dropdown-item"><a aria-current="page" href="/en/config/routing.html" class="router-link-active router-link-exact-active nav-link router-link-active" aria-label="English (WIP)"><!--[--><!--]--> English (WIP) <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/xtls/xray-core" rel="noopener noreferrer" target="_blank" aria-label="Source"><!--[--><!--]--> Source <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><div class="sidebar-mask"></div><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/en" class="nav-link router-link-active" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/en/about/news.md" class="nav-link" aria-label="大史记"><!--[--><!--]--> 大史记 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/en/config/" class="nav-link router-link-active" aria-label="配置指南"><!--[--><!--]--> 配置指南 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/en/development/" class="nav-link" aria-label="开发指南"><!--[--><!--]--> 开发指南 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/en/document/" class="nav-link" aria-label="使用指南"><!--[--><!--]--> 使用指南 <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/config/routing.html" class="nav-link" aria-label="简体中文"><!--[--><!--]--> 简体中文 <!--[--><!--]--></a></li><li class="dropdown-item"><a aria-current="page" href="/en/config/routing.html" class="router-link-active router-link-exact-active nav-link router-link-active" aria-label="English (WIP)"><!--[--><!--]--> English (WIP) <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/xtls/xray-core" rel="noopener noreferrer" target="_blank" aria-label="Source"><!--[--><!--]--> Source <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><p class="sidebar-heading sidebar-item">特性详解</p><ul class=""><li><!--[--><a href="/en/config/features/xtls.html" class="nav-link sidebar-item" aria-label="XTLS 深度剖析"><!--[--><!--]--> XTLS 深度剖析 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/en/config/features/fallback.html" class="nav-link sidebar-item" aria-label="Fallback 回落"><!--[--><!--]--> Fallback 回落 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/en/config/features/browser_dialer.html" class="nav-link sidebar-item" aria-label="Browser Dialer"><!--[--><!--]--> Browser Dialer <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/en/config/features/env.html" class="nav-link sidebar-item" aria-label="环境变量"><!--[--><!--]--> 环境变量 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/en/config/features/multiple.html" class="nav-link sidebar-item" aria-label="多文件配置"><!--[--><!--]--> 多文件配置 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item active">基础配置</p><ul class=""><li><!--[--><a href="/en/config/" class="nav-link router-link-active sidebar-item" aria-label="Configurations"><!--[--><!--]--> Configurations <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/en/config/log.html" class="nav-link sidebar-item" aria-label="Log Configuration"><!--[--><!--]--> Log Configuration <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/en/config/api.html" class="nav-link sidebar-item" aria-label="API Interface"><!--[--><!--]--> API Interface <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/en/config/dns.html" class="nav-link sidebar-item" aria-label="Built-in DNS Server"><!--[--><!--]--> Built-in DNS Server <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/en/config/fakedns.html" class="nav-link sidebar-item" aria-label="FakeDNS"><!--[--><!--]--> FakeDNS <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/en/config/inbound.html" class="nav-link sidebar-item" aria-label="Inbound Proxy"><!--[--><!--]--> Inbound Proxy <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/en/config/outbound.html" class="nav-link sidebar-item" aria-label="Outbound Proxies"><!--[--><!--]--> Outbound Proxies <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/en/config/policy.html" class="nav-link sidebar-item" aria-label="Local Policy"><!--[--><!--]--> Local Policy <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/en/config/reverse.html" class="nav-link sidebar-item" aria-label="Reverse Proxy"><!--[--><!--]--> Reverse Proxy <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/en/config/routing.html" class="router-link-active router-link-exact-active nav-link router-link-active sidebar-item active" aria-label="Routing"><!--[--><!--]--> Routing <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/en/config/routing.html#routingobject" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="RoutingObject"><!--[--><!--]--> RoutingObject <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/en/config/routing.html#ruleobject" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="RuleObject"><!--[--><!--]--> RuleObject <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/en/config/routing.html#balancerobject" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="BalancerObject"><!--[--><!--]--> BalancerObject <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/en/config/routing.html#predefined-domain-lists" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Predefined Domain Lists"><!--[--><!--]--> Predefined Domain Lists <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li></ul><!--]--></li><li><!--[--><a href="/en/config/stats.html" class="nav-link sidebar-item" aria-label="Traffic Statistics"><!--[--><!--]--> Traffic Statistics <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/en/config/transport.html" class="nav-link sidebar-item" aria-label="Transport Protocol"><!--[--><!--]--> Transport Protocol <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">入站代理</p><ul class=""><li><!--[--><a href="/en/config/inbounds/dokodemo.html" class="nav-link sidebar-item" aria-label="Dokodemo-Door"><!--[--><!--]--> Dokodemo-Door <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/en/config/inbounds/http.html" class="nav-link sidebar-item" aria-label="HTTP"><!--[--><!--]--> HTTP <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/en/config/inbounds/shadowsocks.html" class="nav-link sidebar-item" aria-label="Shadowsocks"><!--[--><!--]--> Shadowsocks <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/en/config/inbounds/socks.html" class="nav-link sidebar-item" aria-label="Socks"><!--[--><!--]--> Socks <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/en/config/inbounds/trojan.html" class="nav-link sidebar-item" aria-label="Trojan"><!--[--><!--]--> Trojan <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/en/config/inbounds/vless.html" class="nav-link sidebar-item" aria-label="VLESS"><!--[--><!--]--> VLESS <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/en/config/inbounds/vmess.html" class="nav-link sidebar-item" aria-label="VMess"><!--[--><!--]--> VMess <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">出站代理</p><ul class=""><li><!--[--><a href="/en/config/outbounds/blackhole.html" class="nav-link sidebar-item" aria-label="Blackhole"><!--[--><!--]--> Blackhole <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/en/config/outbounds/dns.html" class="nav-link sidebar-item" aria-label="DNS"><!--[--><!--]--> DNS <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/en/config/outbounds/freedom.html" class="nav-link sidebar-item" aria-label="Freedom"><!--[--><!--]--> Freedom <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/en/config/outbounds/http.html" class="nav-link sidebar-item" aria-label="HTTP"><!--[--><!--]--> HTTP <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/en/config/outbounds/shadowsocks.html" class="nav-link sidebar-item" aria-label="Shadowsocks"><!--[--><!--]--> Shadowsocks <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/en/config/outbounds/socks.html" class="nav-link sidebar-item" aria-label="Socks"><!--[--><!--]--> Socks <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/en/config/outbounds/trojan.html" class="nav-link sidebar-item" aria-label="Trojan"><!--[--><!--]--> Trojan <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/en/config/outbounds/vless.html" class="nav-link sidebar-item" aria-label="VLESS"><!--[--><!--]--> VLESS <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/en/config/outbounds/vmess.html" class="nav-link sidebar-item" aria-label="VMess"><!--[--><!--]--> VMess <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/en/config/outbounds/wireguard.html" class="nav-link sidebar-item" aria-label="Wireguard"><!--[--><!--]--> Wireguard <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">底层传输</p><ul class=""><li><!--[--><a href="/en/config/transports/grpc.html" class="nav-link sidebar-item" aria-label="gRPC"><!--[--><!--]--> gRPC <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/en/config/transports/h2.html" class="nav-link sidebar-item" aria-label="HTTP/2"><!--[--><!--]--> HTTP/2 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/en/config/transports/mkcp.html" class="nav-link sidebar-item" aria-label="mKCP"><!--[--><!--]--> mKCP <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/en/config/transports/quic.html" class="nav-link sidebar-item" aria-label="QUIC"><!--[--><!--]--> QUIC <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/en/config/transports/tcp.html" class="nav-link sidebar-item" aria-label="TCP"><!--[--><!--]--> TCP <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/en/config/transports/websocket.html" class="nav-link sidebar-item" aria-label="WebSocket"><!--[--><!--]--> WebSocket <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="routing" tabindex="-1"><a class="header-anchor" href="#routing" aria-hidden="true">#</a> Routing</h1><p>The routing module can send inbound data through different outbound connections according to different rules to achieve on-demand proxying.</p><p>A common use case is to split domestic and foreign traffic. Xray can use its internal mechanisms to determine the traffic from different regions and then send them to different outbound proxies.</p><p>For a more detailed analysis of the routing function, please refer to <a href="https://xtls.github.io/document/level-1/routing-lv1-part1.html" target="_blank" rel="noopener noreferrer">Routing Function Analysis<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>.</p><h2 id="routingobject" tabindex="-1"><a class="header-anchor" href="#routingobject" aria-hidden="true">#</a> RoutingObject</h2><p><code>RoutingObject</code> corresponds to the <code>routing</code> item in the configuration file.</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;routing&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;domainStrategy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;AsIs&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;domainMatcher&quot;</span><span class="token operator">:</span> <span class="token string">&quot;hybrid&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;rules&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;balancers&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><blockquote><p><code>domainStrategy</code>: &quot;AsIs&quot; | &quot;IPIfNonMatch&quot; | &quot;IPOnDemand&quot;</p></blockquote><p>The domain name resolution strategy, which uses different strategies based on different settings.</p><ul><li><p><code>&quot;AsIs&quot;</code>: Use only the domain name for routing selection. Default value.</p></li><li><p><code>&quot;IPIfNonMatch&quot;</code>: If the domain name does not match any rule, resolve the domain name into an IP address (A record or AAAA record) and match it again;</p><ul><li>When a domain name has multiple A records, it will try to match all A records until one of them matches a rule;</li><li>The resolved IP only works for routing selection, and the original domain name is still used in the forwarded packets;</li></ul></li><li><p><code>&quot;IPOnDemand&quot;</code>: If any IP-based rules are encountered during matching, immediately resolve the domain name into an IP address for matching;</p></li></ul><blockquote><p><code>domainMatcher</code>: &quot;hybrid&quot; | &quot;linear&quot;</p></blockquote><p>The domain name matching algorithm, which uses different algorithms based on different settings. This option affects all <code>RuleObject</code> that do not have a separately specified matching algorithm.</p><ul><li><code>&quot;hybrid&quot;</code>: Use the new domain name matching algorithm, which is faster and takes up less space. Default value.</li><li><code>&quot;linear&quot;</code>: Use the original domain name matching algorithm.</li></ul><blockquote><p><code>rules</code>: [<a href="#ruleobject">RuleObject</a>]</p></blockquote><p>An array corresponding to a list of rules.</p><p>For each connection, the routing will judge these rules from top to bottom in order. When it encounters the first effective rule, it will forward the connection to the <code>outboundTag</code> or <code>balancerTag</code> specified by the rule.</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>When no rules match, the traffic is sent out by the first outbound by default.</p></div><blockquote><p><code>balancers</code>: [ <a href="#balancerobject">BalancerObject</a> ]</p></blockquote><p>An array corresponding to a list of load balancers.</p><p>When a rule points to a load balancer, Xray selects an outbound through this load balancer, and then it forwards the traffic through it.</p><h3 id="ruleobject" tabindex="-1"><a class="header-anchor" href="#ruleobject" aria-hidden="true">#</a> RuleObject</h3><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;domainMatcher&quot;</span><span class="token operator">:</span> <span class="token string">&quot;hybrid&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;field&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;domain&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;baidu.com&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;qq.com&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;geosite:cn&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;ip&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;0.0.0.0/8&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;10.0.0.0/8&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;fc00::/7&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;fe80::/10&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;geoip:cn&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token string">&quot;53,443,1000-2000&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;sourcePort&quot;</span><span class="token operator">:</span> <span class="token string">&quot;53,443,1000-2000&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;network&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tcp&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;source&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;10.0.0.1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;user&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;love@xray.com&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;inboundTag&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;tag-vmess&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;protocol&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tls&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bittorrent&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;attrs&quot;</span><span class="token operator">:</span> <span class="token string">&quot;attrs[&#39;:method&#39;] == &#39;GET&#39;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;outboundTag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;direct&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;balancerTag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;balancer&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><div class="custom-container danger"><p class="custom-container-title">DANGER</p><p>When multiple attributes are specified at the same time, these attributes need to be satisfied <strong>simultaneously</strong> in order for the current rule to take effect.</p></div><blockquote><p><code>domainMatcher</code>: &quot;hybrid&quot; | &quot;linear&quot;</p></blockquote><p>The domain matching algorithm used varies depending on the settings. The option here takes priority over the <code>domainMatcher</code> configured in <code>RoutingObject</code>.</p><ul><li><code>&quot;hybrid&quot;</code>: uses a new domain matching algorithm that is faster and takes up less space. This is the default value.</li><li><code>&quot;linear&quot;</code>: uses the original domain matching algorithm.</li></ul><blockquote><p><code>type</code>: &quot;field&quot;</p></blockquote><p>Currently, only the option <code>&quot;field&quot;</code> is supported.</p><blockquote><p><code>domain</code>: [string]</p></blockquote><p>An array where each item is a domain match. There are several forms:</p><ul><li>Plain string: If this string matches any part of the target domain, the rule takes effect. For example, &quot;sina.com&quot; can match &quot;sina.com&quot;, &quot;sina.com.cn&quot;, and &quot;www.sina.com&quot;, but not &quot;sina.cn&quot;.</li><li>Regular expression: Starts with <code>&quot;regexp:&quot;</code> followed by a regular expression. When this regular expression matches the target domain, the rule takes effect. For example, &quot;regexp:\.goo.*\.com<!--vuepress-ssr-app-->quot; matches &quot;www.google.com&quot; or &quot;fonts.googleapis.com&quot;, but not &quot;google.com&quot;.</li><li>Subdomain (recommended): Starts with <code>&quot;domain:&quot;</code> followed by a domain. When this domain is the target domain or a subdomain of the target domain, the rule takes effect. For example, &quot;domain:xray.com&quot; matches &quot;www.xray.com&quot; and &quot;xray.com&quot;, but not &quot;wxray.com&quot;.</li><li>Exact match: Starts with <code>&quot;full:&quot;</code> followed by a domain. When this domain is an exact match for the target domain, the rule takes effect. For example, &quot;full:xray.com&quot; matches &quot;xray.com&quot; but not &quot;www.xray.com&quot;.</li><li>Predefined domain list: Starts with <code>&quot;geosite:&quot;</code> followed by a name such as <code>geosite:google</code> or <code>geosite:cn</code>. The names and domain lists are listed in <a href="#predefined-domain-list">Predefined Domain List</a>.</li><li>Load domains from a file: Formatted as <code>&quot;ext:file:tag&quot;</code>, where the file is stored in the <a href="/en/config/features/env.html#resource-file-path" class="">resource directory</a> and has the same format as <code>geosite.dat</code>. The tag must exist in the file.</li></ul><div class="custom-container tip"><p class="custom-container-title">TIP</p><p><code>&quot;ext:geoip.dat:cn&quot;</code> is equivalent to <code>&quot;geoip:cn&quot;</code></p></div><p><code>ip</code>: [string]</p><p>An array where each item represents an IP range. This rule will take effect when the target IP matches any of the IP ranges in the array. There are several types of IP ranges:</p><ul><li><p>IP: In the format of <code>&quot;127.0.0.1&quot;</code>.</p></li><li><p><a href="https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing" target="_blank" rel="noopener noreferrer">CIDR<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>: In the format of <code>&quot;10.0.0.0/8&quot;</code>.</p></li><li><p>Predefined IP lists: These lists are included in every Xray installation package under the file name <code>geoip.dat</code>. They can be used in the format of <code>&quot;geoip:cn&quot;</code>, where <code>cn</code> is a two-letter country code. The prefix <code>geoip:</code>(all lowercase) must be used, and nearly all countries that have internet access are supported.</p><ul><li>Special value: <code>&quot;geoip:private&quot;</code>, which includes all private addresses, such as <code>127.0.0.1</code>.</li></ul></li><li><p>Loading IP from a file: In the format of <code>&quot;ext:file:tag&quot;</code>, where <code>file</code> is the file name and <code>tag</code> is a label that must exist in the file. The prefix <code>ext:</code> (all lowercase) must be used, and the file should be located in the <a href="/en/config/features/env.html#resource-file-path" class="">resource directory</a> with the same format as <code>geoip.dat</code>.</p></li></ul><blockquote><p><code>port</code>: number | string</p></blockquote><p>The target port range, which can take on three forms:</p><ul><li><code>&quot;a-b&quot;</code>: <code>a</code> and <code>b</code> are both positive integers less than 65536. This range is a closed interval, and this rule will take effect when the target port falls within this range.</li><li><code>a</code>: <code>a</code> is a positive integer less than 65536. This rule will take effect when the target port is <code>a</code>.</li><li>A mixture of the above two forms, separated by commas &quot;,&quot;. For example: <code>&quot;53,443,1000-2000&quot;</code>.</li></ul><blockquote><p><code>sourcePort</code>: number | string</p></blockquote><p>The source port, which can take on three forms:</p><ul><li><code>&quot;a-b&quot;</code>: <code>a</code> and <code>b</code> are both positive integers less than 65536. This range is a closed interval, and this rule will take effect when the source port falls within this range.</li><li><code>a</code>: <code>a</code> is a positive integer less than 65536. This rule will take effect when the source port is <code>a</code>.</li><li>A mixture of the above two forms, separated by commas &quot;,&quot;. For example: <code>&quot;53,443,1000-2000&quot;</code>.</li></ul><blockquote><p><code>network</code>: &quot;tcp&quot; | &quot;udp&quot; | &quot;tcp,udp&quot;</p></blockquote><p>This can be &quot;tcp&quot;, &quot;udp&quot;, or &quot;tcp,udp&quot;. This rule will take effect when the connection method is the specified one.</p><blockquote><p><code>source</code>: [string]</p></blockquote><p>An array where each item represents an IP range in the format of IP, CIDR, GeoIP, or loading IP from a file. This rule will take effect when the source IP matches any of the IP ranges in the array.</p><blockquote><p><code>user</code>: [string]</p></blockquote><p>An array where each item represents an email address. This rule will take effect when the source user matches any of the email addresses in the array.</p><blockquote><p><code>inboundTag</code>: [string]</p></blockquote><p>An array where each item represents an identifier. This rule will take effect when the inbound protocol matches any of the identifiers in the array.</p><blockquote><p><code>protocol</code>: [ &quot;http&quot; | &quot;tls&quot; | &quot;bittorrent&quot; ]</p></blockquote><p>An array where each item represents a protocol. This rule will take effect when the protocol of the current connection matches any of the protocols in the array.</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>The <code>sniffing</code> option in the inbound proxy must be enabled to detect the protocol type used by the connection.</p></div><p><code>attrs</code>: string</p><p>A script used to detect the attribute values of the traffic. When this script returns a truthy value, this rule takes effect.</p><p>The script language is <a href="https://github.com/bazelbuild/starlark" target="_blank" rel="noopener noreferrer">Starlark<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>, which is a subset of Python syntax. The script accepts a global variable <code>attrs</code>, which contains traffic-related attributes.</p><p>Currently, only the inbound HTTP proxy sets this attribute.</p><p>Examples:</p><ul><li>Detect HTTP GET: <code>&quot;attrs[&#39;:method&#39;] == &#39;GET&#39;&quot;</code></li><li>Detect HTTP Path: <code>&quot;attrs[&#39;:path&#39;].startswith(&#39;/test&#39;)&quot;</code></li><li>Detect Content Type: <code>&quot;attrs[&#39;accept&#39;].index(&#39;text/html&#39;) &gt;= 0&quot;</code></li></ul><blockquote><p><code>outboundTag</code>: string</p></blockquote><p>Corresponds to the identifier of an outbound.</p><blockquote><p><code>balancerTag</code>: string</p></blockquote><p>Corresponds to the identifier of a balancer.</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p><code>balancerTag</code> and <code>outboundTag</code> are mutually exclusive. When both are specified, <code>outboundTag</code> takes effect.</p></div><h3 id="balancerobject" tabindex="-1"><a class="header-anchor" href="#balancerobject" aria-hidden="true">#</a> BalancerObject</h3><p>Load balancer configuration. When a load balancer is in effect, it selects the most appropriate outbound from the specified outbound according to the configuration and forwards traffic.</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;tag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;balancer&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;selector&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p><code>tag</code>: string</p></blockquote><p>The identifier of this load balancer, used to match <code>balancerTag</code> in <code>RuleObject</code>.</p><blockquote><p><code>selector</code>: [ string ]</p></blockquote><p>An array of strings, each of which will be used to match the prefix of the outbound identifier. For example, in the following outbound identifiers: <code>[ &quot;a&quot;, &quot;ab&quot;, &quot;c&quot;, &quot;ba&quot; ]</code>, <code>&quot;selector&quot;: [&quot;a&quot;]</code> will match <code>[ &quot;a&quot;, &quot;ab&quot; ]</code>.</p><p>If multiple outbounds are matched, the load balancer currently selects one randomly as the final outbound.</p><h3 id="predefined-domain-lists" tabindex="-1"><a class="header-anchor" href="#predefined-domain-lists" aria-hidden="true">#</a> Predefined Domain Lists</h3><p>This list is included in every Xray installation package, and the file name is <code>geosite.dat</code>. This file contains some common domain names, which can be used as <code>geosite:filename</code> to perform routing or DNS filtering for domain names that match those in the file.</p><p>Common domain lists include:</p><ul><li><code>category-ads</code>: Contains common advertising domain names.</li><li><code>category-ads-all</code>: Contains common advertising domain names and advertising provider domain names.</li><li><code>cn</code>: Equivalent to the combination of <code>geolocation-cn</code> and <code>tld-cn</code>.</li><li><code>apple</code>: Contains most of the domain names under Apple.</li><li><code>google</code>: Contains most of the domain names under Google.</li><li><code>microsoft</code>: Contains most of the domain names under Microsoft.</li><li><code>facebook</code>: Contains most of the domain names under Facebook.</li><li><code>twitter</code>: Contains most of the domain names under Twitter.</li><li><code>telegram</code>: Contains most of the domain names under Telegram.</li><li><code>geolocation-cn</code>: Contains common domain names of mainland Chinese websites.</li><li><code>geolocation-!cn</code>: Contains common domain names of non-mainland Chinese websites, as well as <code>tld-!cn</code>.</li><li><code>tld-cn</code>: Contains top-level domain names managed by CNNIC for mainland China, such as domain names ending in <code>.cn</code> and <code>.中国</code>.</li><li><code>tld-!cn</code>: Contains top-level domain names used outside mainland China, such as domain names ending in <code>.hk</code> (Hong Kong), <code>.tw</code> (Taiwan), <code>.jp</code> (Japan), <code>.sg</code> (Singapore), <code>.us</code> (United States), and <code>.ca</code> (Canada).</li></ul><p>You can also find the complete list of domain names here: <a href="https://github.com/v2fly/domain-list-community" target="_blank" rel="noopener noreferrer">Domain list community<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>.</p><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="nav-link external meta-item-label" href="https://github.com/xtls/Xray-docs-next/edit/main/docs/en/config/routing.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><span class="meta-item-info">3/12/2023, 1:44:54 AM</span></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 126307318+Winston2084@users.noreply.github.com">Winston2084</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: 82594500+hmol233@users.noreply.github.com">hmol233</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: 1588741+yuhan6665@users.noreply.github.com">yuhan6665</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"> ← <a href="/en/config/reverse.html" class="nav-link" aria-label="Reverse Proxy"><!--[--><!--]--> Reverse Proxy <!--[--><!--]--></a></span><span class="next"><a href="/en/config/stats.html" class="nav-link" aria-label="Traffic Statistics"><!--[--><!--]--> Traffic Statistics <!--[--><!--]--></a> → </span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script src="/assets/js/runtime~app.348769b8.js" defer></script><script src="/assets/js/3469.6a78c325.js" defer></script><script src="/assets/js/app.8c77f577.js" defer></script>
  </body>
</html>
