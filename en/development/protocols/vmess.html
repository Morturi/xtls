<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.25">
    <link rel="icon" href="/logo.png"><title>VMess Protocol | Project X</title><meta name="description" content="Official document of Xray">
    <link rel="preload" href="/assets/js/runtime~app.f5ac610c.js" as="script"><link rel="preload" href="/assets/css/styles.f4ef6178.css" as="style"><link rel="preload" href="/assets/js/3469.574b203c.js" as="script"><link rel="preload" href="/assets/js/app.c68b3277.js" as="script">
    <link rel="stylesheet" href="/assets/css/styles.f4ef6178.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/en/" class=""><!----><span class="site-name">Project X</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="/en" class="nav-link router-link-active" aria-label="Homepage"><!--[--><!--]--> Homepage <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/en/about/news.md" class="nav-link" aria-label="Website History"><!--[--><!--]--> Website History <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/en/config/" class="nav-link" aria-label="Config Reference"><!--[--><!--]--> Config Reference <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/en/development/" class="nav-link router-link-active" aria-label="Developer Guide"><!--[--><!--]--> Developer Guide <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/en/document/" class="nav-link" aria-label="Quick Start"><!--[--><!--]--> Quick Start <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/development/protocols/vmess.html" class="nav-link" aria-label="简体中文"><!--[--><!--]--> 简体中文 <!--[--><!--]--></a></li><li class="dropdown-item"><a aria-current="page" href="/en/development/protocols/vmess.html" class="router-link-active router-link-exact-active nav-link router-link-active" aria-label="English (WIP)"><!--[--><!--]--> English (WIP) <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/xtls/xray-core" rel="noopener noreferrer" target="_blank" aria-label="Source"><!--[--><!--]--> Source <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><div class="sidebar-mask"></div><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/en" class="nav-link router-link-active" aria-label="Homepage"><!--[--><!--]--> Homepage <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/en/about/news.md" class="nav-link" aria-label="Website History"><!--[--><!--]--> Website History <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/en/config/" class="nav-link" aria-label="Config Reference"><!--[--><!--]--> Config Reference <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/en/development/" class="nav-link router-link-active" aria-label="Developer Guide"><!--[--><!--]--> Developer Guide <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/en/document/" class="nav-link" aria-label="Quick Start"><!--[--><!--]--> Quick Start <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/development/protocols/vmess.html" class="nav-link" aria-label="简体中文"><!--[--><!--]--> 简体中文 <!--[--><!--]--></a></li><li class="dropdown-item"><a aria-current="page" href="/en/development/protocols/vmess.html" class="router-link-active router-link-exact-active nav-link router-link-active" aria-label="English (WIP)"><!--[--><!--]--> English (WIP) <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/xtls/xray-core" rel="noopener noreferrer" target="_blank" aria-label="Source"><!--[--><!--]--> Source <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><p class="sidebar-heading sidebar-item active">Developer Guide</p><ul class=""><li><!--[--><a href="/en/development/intro/compile.html" class="nav-link sidebar-item" aria-label="Compile the document"><!--[--><!--]--> Compile the document <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/en/development/intro/design.html" class="nav-link sidebar-item" aria-label="Design Objectives"><!--[--><!--]--> Design Objectives <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/en/development/intro/guide.html" class="nav-link sidebar-item" aria-label="Development Standards"><!--[--><!--]--> Development Standards <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><p class="sidebar-item active">Protocol Details</p><ul class="sidebar-sub-items"><li><!--[--><a href="/en/development/protocols/vless.html" class="nav-link sidebar-item" aria-label="VLESS Protocol"><!--[--><!--]--> VLESS Protocol <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/en/development/protocols/vmess.html" class="router-link-active router-link-exact-active nav-link router-link-active sidebar-item active" aria-label="VMess Protocol"><!--[--><!--]--> VMess Protocol <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/en/development/protocols/vmess.html#version" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Version"><!--[--><!--]--> Version <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/en/development/protocols/vmess.html#dependencies" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Dependencies"><!--[--><!--]--> Dependencies <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/en/development/protocols/vmess.html#underlying-protocol" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Underlying Protocol"><!--[--><!--]--> Underlying Protocol <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/en/development/protocols/vmess.html#user-id" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="User ID"><!--[--><!--]--> User ID <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/en/development/protocols/vmess.html#functions" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Functions"><!--[--><!--]--> Functions <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/en/development/protocols/vmess.html#communication-process" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Communication Process"><!--[--><!--]--> Communication Process <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/en/development/protocols/vmess.html#client-request" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Client Request"><!--[--><!--]--> Client Request <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/en/development/protocols/vmess.html#authentication-information" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Authentication Information"><!--[--><!--]--> Authentication Information <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/en/development/protocols/vmess.html#command-section" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Command Section"><!--[--><!--]--> Command Section <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/en/development/protocols/vmess.html#data-section" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Data Section"><!--[--><!--]--> Data Section <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/en/development/protocols/vmess.html#server-response" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Server Response"><!--[--><!--]--> Server Response <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/en/development/protocols/vmess.html#dynamic-port-instructions" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Dynamic Port Instructions"><!--[--><!--]--> Dynamic Port Instructions <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/en/development/protocols/vmess.html#comment" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Comment"><!--[--><!--]--> Comment <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a href="/en/development/protocols/muxcool.html" class="nav-link sidebar-item" aria-label="Mux.Cool Protocol"><!--[--><!--]--> Mux.Cool Protocol <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/en/development/protocols/mkcp.html" class="nav-link sidebar-item" aria-label="mKCP Protocol"><!--[--><!--]--> mKCP Protocol <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="vmess-protocol" tabindex="-1"><a class="header-anchor" href="#vmess-protocol" aria-hidden="true">#</a> VMess Protocol</h1><p>VMess is an encrypted transmission protocol that can serve as a bridge between the Xray client and server.</p><h2 id="version" tabindex="-1"><a class="header-anchor" href="#version" aria-hidden="true">#</a> Version</h2><p>The current version number is 1.</p><h2 id="dependencies" tabindex="-1"><a class="header-anchor" href="#dependencies" aria-hidden="true">#</a> Dependencies</h2><h3 id="underlying-protocol" tabindex="-1"><a class="header-anchor" href="#underlying-protocol" aria-hidden="true">#</a> Underlying Protocol</h3><p>VMess is a TCP-based protocol where all data is transmitted over TCP.</p><h3 id="user-id" tabindex="-1"><a class="header-anchor" href="#user-id" aria-hidden="true">#</a> User ID</h3><p>An ID is equivalent to a <a href="https://en.wikipedia.org/wiki/Universally_unique_identifier" target="_blank" rel="noopener noreferrer">UUID<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>, which is a 16-byte long random number. Its function is similar to a token. An ID looks like: <code>de305d54-75b4-431b-adb2-eb6b9e546014</code>, it is almost entirely random and can be generated using any UUID generator, such as <a href="https://www.uuidgenerator.net/" target="_blank" rel="noopener noreferrer">this one<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>.</p><p>User ID can be specified in the <a href="../../config">configuration file</a>.</p><h3 id="functions" tabindex="-1"><a class="header-anchor" href="#functions" aria-hidden="true">#</a> Functions</h3><ul><li>MD5: <a href="https://en.wikipedia.org/wiki/MD5" target="_blank" rel="noopener noreferrer">MD5 Function<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a><ul><li>Input parameter is any length byte array</li><li>Output is a 16-byte array</li></ul></li><li>HMAC: <a href="https://en.wikipedia.org/wiki/Hash-based_message_authentication_code" target="_blank" rel="noopener noreferrer">HMAC Function<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a><ul><li>Input parameters are: <ul><li>H: Hash function</li><li>K: Key, any length byte array</li><li>M: Message, any length byte array</li></ul></li></ul></li><li>Shake: <a href="https://en.wikipedia.org/wiki/SHA-3" target="_blank" rel="noopener noreferrer">SHA3-Shake128 Function<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a><ul><li>Input parameter is any length string</li><li>Output is any length string</li></ul></li></ul><h2 id="communication-process" tabindex="-1"><a class="header-anchor" href="#communication-process" aria-hidden="true">#</a> Communication Process</h2><p>VMess is a stateless protocol, which means that data can be transmitted directly between the client and the server without the need for a handshake. Each data transmission has no impact on other data transmissions before or after it.</p><p>When a VMess client initiates a request, the server checks whether the request comes from a legitimate client. If the validation passes, the server forwards the request and sends the obtained response back to the client.</p><p>VMess uses an asymmetric format, meaning that the requests sent by the client and the responses from the server use different formats.</p><h2 id="client-request" tabindex="-1"><a class="header-anchor" href="#client-request" aria-hidden="true">#</a> Client Request</h2><table><thead><tr><th>16 Bytes</th><th>X Bytes</th><th>Remaining</th></tr></thead><tbody><tr><td>Authentication Information</td><td>Instruction Part</td><td>Data Part</td></tr></tbody></table><h3 id="authentication-information" tabindex="-1"><a class="header-anchor" href="#authentication-information" aria-hidden="true">#</a> Authentication Information</h3><p>The authentication information is a 16-byte hash (hash) value, which is calculated as follows:</p><ul><li>H = MD5</li><li>K = User ID (16 bytes)</li><li>M = UTC time accurate to seconds, with a random value of ±30 seconds from the current time (8 bytes, Big Endian)</li><li>Hash = HMAC(H, K, M)</li></ul><h3 id="command-section" tabindex="-1"><a class="header-anchor" href="#command-section" aria-hidden="true">#</a> Command Section</h3><p>The instruction part is encrypted using AES-128-CFB.</p><ul><li>Key: MD5(user ID + []byte(&#39;c48619fe-8f02-49e0-b9e9-edf763e17e21&#39;))</li><li>IV: MD5(X + X + X + X), X = []byte(time generated by authentication information) (8 bytes, Big Endian)</li></ul><table><thead><tr><th style="text-align:center;">1 Byte</th><th style="text-align:center;">16 Bytes</th><th style="text-align:center;">16 Bytes</th><th style="text-align:center;">1 Byte</th><th style="text-align:center;">1 Byte</th><th style="text-align:center;">4 bits</th><th style="text-align:center;">4 bits</th><th style="text-align:center;">1 Byte</th><th style="text-align:center;">1 Byte</th><th style="text-align:center;">2 Bytes</th><th style="text-align:center;">1 Byte</th><th style="text-align:center;">N Bytes</th><th style="text-align:center;">P Bytes</th><th style="text-align:center;">4 Bytes</th></tr></thead><tbody><tr><td style="text-align:center;">Version</td><td style="text-align:center;">Data Encryption IV</td><td style="text-align:center;">Data Encryption Key</td><td style="text-align:center;">Response Authentication Value</td><td style="text-align:center;">Options</td><td style="text-align:center;">Reserved</td><td style="text-align:center;">Encryption Method</td><td style="text-align:center;">Reserved</td><td style="text-align:center;">Command</td><td style="text-align:center;">Port</td><td style="text-align:center;">Address Type</td><td style="text-align:center;">Address</td><td style="text-align:center;">Random Value</td><td style="text-align:center;">Checksum</td></tr></tbody></table><p>Options Opt Details: (When a bit is 1, it means the option is enabled)</p><table><thead><tr><th style="text-align:center;">0</th><th style="text-align:center;">1</th><th style="text-align:center;">2</th><th style="text-align:center;">3</th><th style="text-align:center;">4</th><th style="text-align:center;">5</th><th style="text-align:center;">6</th><th style="text-align:center;">7</th></tr></thead><tbody><tr><td style="text-align:center;">X</td><td style="text-align:center;">X</td><td style="text-align:center;">X</td><td style="text-align:center;">X</td><td style="text-align:center;">X</td><td style="text-align:center;">M</td><td style="text-align:center;">R</td><td style="text-align:center;">S</td></tr></tbody></table><p>of which:</p><ul><li>Version Number Ver: Always 1;</li><li>Data Encryption IV: Random value;</li><li>Data Encryption Key: Random value;</li><li>Response Authentication V: Random value;</li><li>Option Opt: <ul><li>S (0x01): Standard format data stream (recommended);</li><li>R (0x02): Client expects to reuse TCP connection (deprecated in Xray 2.23+); <ul><li>This item only takes effect when S is enabled;</li></ul></li><li>M (0x04): Enable metadata obfuscation (recommended); <ul><li>This item only takes effect when S is enabled;</li><li>When this item is enabled, the client and server need to construct two Shake instances respectively, RequestMask = Shake (request data IV), ResponseMask = Shake (response data IV).</li></ul></li><li>X: Reserved</li></ul></li><li>Redundancy P: Random value added before checksum value;</li><li>Encryption Method: Specify the encryption method for the data part, and the optional values are: <ul><li>0x00: AES-128-CFB;</li><li>0x01: No encryption;</li><li>0x02: AES-128-GCM;</li><li>0x03: ChaCha20-Poly1305;</li></ul></li><li>Instruction Cmd: <ul><li>0x01: TCP data;</li><li>0x02: UDP data;</li></ul></li><li>Port Port: Integer port number in Big Endian format;</li><li>Address Type T: <ul><li>0x01: IPv4</li><li>0x02: Domain name</li><li>0x03: IPv6</li></ul></li><li>Address A: <ul><li>When T = 0x01, A is a 4-byte IPv4 address;</li><li>When T = 0x02, A is a 1-byte length (L) + L-byte domain name;</li><li>When T = 0x03, A is a 16-byte IPv6 address;</li></ul></li><li>Check F: FNV1a hash of all content in the instruction except F.</li></ul><h3 id="data-section" tabindex="-1"><a class="header-anchor" href="#data-section" aria-hidden="true">#</a> Data Section</h3><p>When Opt(S) is enabled, this format is used for the data section. The actual request data is divided into several small chunks, and each chunk has the following format. After the server verifies all the small chunks, it will be forwarded in the basic format.</p><table><thead><tr><th style="text-align:center;">2 Bytes</th><th style="text-align:center;">L Bytes</th></tr></thead><tbody><tr><td style="text-align:center;">Length L</td><td style="text-align:center;">Data Packet</td></tr></tbody></table><p>in which:</p><ul><li>Length L: A big-endian integer with a maximum value of 2^14. <ul><li>When Opt(M) is enabled, the value of L is equal to the true value xor Mask. Mask = (RequestMask.NextByte() &lt;&lt; 8) + RequestMask.NextByte();</li></ul></li><li>Packet: A data packet encrypted by the specified encryption method.</li></ul><p>Before the transmission is completed, the data packet must contain actual data, in addition to the length and authentication data. When the transmission is complete, the client must send an empty data packet, that is, L = 0 (unencrypted) or the length of the authentication data (encrypted), to indicate the end of the transmission.</p><p>The packets are formatted as follows, depending on the encryption method:</p><ul><li>Unencrypted:   - L bytes: actual data;</li><li>AES-128-CFB: The entire data section is encrypted using AES-128-CFB.   - 4 bytes: FNV1a hash of actual data;   - L - 4 bytes: actual data;</li><li>AES-128-GCM: Key is the Key of the instruction section, IV = count (2 bytes) + IV (10 bytes). count starts at 0 and increases by 1 for each packet; IV is the 3rd to 12th byte of the instruction section IV.   - L - 16 bytes: actual data;   - 16 bytes: GCM authentication information</li><li>ChaCha20-Poly1305: Key = MD5 (instruction part Key) + MD5 (MD5 (instruction part Key)), IV = count (2 bytes) + IV (10 bytes). count starts at 0 and increases by 1 for each packet; IV is the 3rd to 12th byte of the instruction section IV.   - L - 16 bytes: actual data;   - 16 bytes: Poly1305 authentication information</li></ul><h2 id="server-response" tabindex="-1"><a class="header-anchor" href="#server-response" aria-hidden="true">#</a> Server Response</h2><p>The header data is encrypted using AES-128-CFB encryption. The IV is MD5 of the data encryption IV, and the Key is MD5 of the data encryption Key. The actual response data varies depending on the encryption settings.</p><table><thead><tr><th>1 Byte</th><th>1 Byte</th><th>1 Byte</th><th>1 Byte</th><th>M Bytes</th><th>Remaining Part</th></tr></thead><tbody><tr><td>Response Authentication V</td><td>Option Opt</td><td>Command Cmd</td><td>Command Length M</td><td>Command Content</td><td>Actual Response Data</td></tr></tbody></table><p>in which：</p><ul><li>Response Authentication V: must match the response authentication V in the client request.</li><li>Option Opt: <ul><li>0x01: server prepares to reuse TCP connections (deprecated in Xray 2.23+).</li></ul></li><li>Command Cmd: <ul><li>0x01: dynamic port command.</li></ul></li><li>Actual response data: <ul><li>If Opt(S) in the request is enabled, the standard format is used. Otherwise, the basic format is used.</li><li>Both formats are identical to the request data. <ul><li>When Opt(M) is enabled, the value of length L is equal to the true value XOR Mask. Mask = (ResponseMask.NextByte() &lt;&lt; 8) + ResponseMask.NextByte().</li></ul></li></ul></li></ul><h3 id="dynamic-port-instructions" tabindex="-1"><a class="header-anchor" href="#dynamic-port-instructions" aria-hidden="true">#</a> Dynamic Port Instructions</h3><table><thead><tr><th>1 Byte</th><th>2 Bytes</th><th>16 Bytes</th><th>2 Bytes</th><th>1 Byte</th><th>1 Byte</th></tr></thead><tbody><tr><td>Reserved</td><td>Port</td><td>User ID</td><td>AlterID</td><td>User level</td><td>Validity period T</td></tr></tbody></table><p>in which:</p><ul><li>Port: Integer port number in Big Endian format</li><li>T: Number of minutes as integer value.</li></ul><p>When the client receives a dynamic port command, the server opens a new port for communication. The client can then send data to the new port. After T minutes, the port will expire, and the client must use the main port to communicate again.</p><h2 id="comment" tabindex="-1"><a class="header-anchor" href="#comment" aria-hidden="true">#</a> Comment</h2><ul><li>To ensure forward compatibility, the values of all reserved fields must be 0.</li></ul><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="nav-link external meta-item-label" href="https://github.com/xtls/Xray-docs-next/edit/main/docs/en/development/protocols/vmess.md" rel="noopener noreferrer" target="_blank" aria-label="Help us improve this page on GitHub！"><!--[--><!--]--> Help us improve this page on GitHub！ <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><span class="meta-item-info">9/21/2023, 8:06:05 PM</span></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 69743130+Eggwite@users.noreply.github.com">Eggwite</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: amiri990.us@gmail.com">Kevin Amiri</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: 82594500+hmol233@users.noreply.github.com">hmol233</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"> ← <a href="/en/development/protocols/vless.html" class="nav-link" aria-label="VLESS Protocol"><!--[--><!--]--> VLESS Protocol <!--[--><!--]--></a></span><span class="next"><a href="/en/development/protocols/muxcool.html" class="nav-link" aria-label="Mux.Cool Protocol"><!--[--><!--]--> Mux.Cool Protocol <!--[--><!--]--></a> → </span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script src="/assets/js/runtime~app.f5ac610c.js" defer></script><script src="/assets/js/3469.574b203c.js" defer></script><script src="/assets/js/app.c68b3277.js" defer></script>
  </body>
</html>
